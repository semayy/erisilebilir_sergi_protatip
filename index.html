<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sergi Erişilebilirlik Uygulaması</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.0.0/dist/jsQR.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text for contrast */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            background-color: #2d3748; /* Slightly lighter dark for container */
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            max-width: 800px; /* Increased max-width for better layout */
            width: 100%;
            text-align: center;
        }
        h1, h3 {
            color: #9f7aea; /* Purple accent for headings */
        }
        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem 1.5rem;
            border: 2px dashed #4a5568; /* Darker gray border */
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #a0aec0; /* Light gray text */
        }
        .file-input-label:hover {
            border-color: #805ad5; /* Darker purple on hover */
            color: #d6bcfa; /* Lighter purple on hover */
        }
        .file-input-label svg {
            margin-right: 0.5rem;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #9f7aea; /* Purple spinner */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7); /* Darker overlay */
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #2d3748; /* Dark modal content */
            margin: auto;
            padding: 30px;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            max-width: 600px;
            width: 90%;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            color: #e2e8f0; /* Light text */
        }

        .close-button {
            color: #a0aec0; /* Light gray close button */
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #ffffff; /* White on hover */
            text-decoration: none;
            cursor: pointer;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .voice-assistant-status {
            font-size: 0.875rem;
            margin-top: 0.5rem;
            color: #a0aec0;
        }
        .voice-assistant-status.listening {
            color: #a7f3d0; /* Light green for listening */
            font-weight: 600;
        }
        .copy-button {
            background-color: #059669; /* Darker green */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        .copy-button:hover {
            background-color: #047857; /* Even darker green on hover */
        }
        /* Output boxes */
        #descriptionOutput, #emotionalOutput, #artworkInfoOutput, #questionOutput {
            background-color: #2a4365; /* Darker blue/indigo shade */
            border: 1px solid #4299e1; /* Blue border */
            color: #e2e8f0; /* Light text */
        }
        #descriptionTitle, #emotionalTitle, #artworkInfoTitle, #answerTitle {
            color: #90cdf4; /* Lighter blue for titles */
        }
        /* Input fields */
        textarea, select {
            background-color: #4a5568; /* Darker gray for inputs */
            color: #e2e8f0; /* Light text */
            border-color: #4a5568;
        }
        textarea::placeholder {
            color: #a0aec0;
        }
        textarea:focus, select:focus {
            border-color: #6366f1;
            ring-color: #6366f1;
        }
        /* Buttons */
        .bg-indigo-600 { background-color: #5a67d8; } /* Adjusted indigo */
        .hover:bg-indigo-700:hover { background-color: #4c51bf; }
        .bg-purple-600 { background-color: #805ad5; } /* Adjusted purple */
        .hover:bg-purple-700:hover { background-color: #6b46c1; }
        .bg-pink-600 { background-color: #d53f8c; } /* Adjusted pink */
        .hover:bg-pink-700:hover { background-color: #b83280; }
        .bg-green-600 { background-color: #38a169; } /* Adjusted green */
        .hover:bg-green-700:hover { background-color: #2f855a; }
        .bg-blue-600 { background-color: #3182ce; } /* Adjusted blue for TİD */
        .hover:bg-blue-700:hover { background-color: #2b6cb0; }
        .bg-yellow-600 { background-color: #d69e2e; } /* Adjusted yellow for QR */
        .hover:bg-yellow-700:hover { background-color: #b7791f; }
        .bg-gray-700 { background-color: #4a5568; } /* Darker gray for voice assistant button */
        .hover:bg-gray-600:hover { background-color: #718096; }
        .text-red-500 { color: #fc8181; } /* Lighter red for errors */
        .mic-icon-active { color: #fc8181; } /* Red for active mic */
        .sign-language-video-placeholder {
            background-color: #1a202c;
            border: 2px dashed #4a5568;
            color: #a0aec0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px; /* Fixed height for placeholder */
            margin-top: 1.5rem;
            border-radius: 0.5rem;
            font-style: italic;
            padding: 1rem;
            text-align: center;
        }
        /* QR Scanner specific styles */
        #qrScannerModal .modal-content {
            max-width: 400px; /* Smaller modal for scanner */
        }
        #video {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            background-color: black;
        }
        #canvas {
            display: none; /* Canvas is for processing, not display */
        }

        /* Styles from the provided index (3).html - adapted for dark theme */
        .elegant-card {
            background-color: #2d3748; /* Darker background for cards */
            backdrop-filter: blur(5px); /* Keep blur for elegance */
            color: #e2e8f0; /* Light text */
        }
        .elegant-border {
            border: 1px solid #4a5568; /* Darker border */
        }
        .elegant-shadow {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); /* Stronger shadow for dark theme */
        }
        .icon-container {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%); /* Darker gradient */
        }
        .icon-container svg {
            color: #9f7aea; /* Purple icon color */
        }
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4); /* Stronger hover shadow */
        }
        .voice-assistant-panel {
            background-color: #2d3748; /* Darker panel */
            color: #e2e8f0;
        }
        .voice-assistant-messages {
            background-color: #1a202c; /* Even darker for messages */
            border-radius: 0.5rem;
            padding: 10px;
        }
        .assistant-message {
            background-color: #2a4365; /* Dark blue for assistant */
            color: #e2e8f0;
        }
        .user-message {
            background-color: #5a67d8; /* Indigo for user */
            color: #ffffff;
        }
        .listening-animation span {
            background-color: #9f7aea; /* Purple animation bars */
        }
        .text-gray-600, .text-gray-700, .text-gray-800, .text-indigo-900 {
            color: #e2e8f0 !important; /* Ensure all text is light */
        }
        .bg-gray-50, .bg-indigo-50, .bg-red-50, .bg-amber-50, .bg-green-50 {
            background-color: #4a5568 !important; /* Darker backgrounds for nested cards/status */
            color: #e2e8f0 !important;
        }
        .text-green-700 { color: #a7f3d0 !important; } /* Light green for status */
        .text-amber-700 { color: #fcd34d !important; } /* Light yellow for status */
        .text-red-800 { color: #fc8181 !important; } /* Light red for status */
        .text-indigo-600 { color: #9f7aea !important; } /* Purple for links/buttons */
        .hover\:bg-indigo-50:hover { background-color: #4a5568 !important; } /* Darker hover for lists */
        .btn-elegant {
            background-color: #4a5568; /* Darker background for elegant buttons */
            color: #e2e8f0;
            border-color: #4a5568;
        }
        .btn-elegant:hover {
            background-color: #718096; /* Lighter grey on hover */
            color: #ffffff;
        }
        .btn-elegant.bg-indigo-900 { background-color: #5a67d8; }
        .btn-elegant.bg-indigo-700 { background-color: #805ad5; }
        .btn-elegant.bg-white { background-color: #4a5568; border-color: #4a5568; }
        .btn-elegant.bg-white:hover { background-color: #718096; }
        .high-contrast .bg-indigo-900 { background-color: #fff !important; color: #000 !important; } /* High contrast button */
        .high-contrast .bg-indigo-700 { background-color: #fff !important; color: #000 !important; } /* High contrast button */

        /* Footer styling */
        footer {
            color: #a0aec0; /* Lighter gray for footer text */
        }
        footer .bg-indigo-200 {
            background-color: #9f7aea; /* Purple line in footer */
        }

        /* Screen reader mode styling */
        .screen-reader-mode .screen-reader-text {
            background: #2d3748; /* Darker background for screen reader text */
            color: #e2e8f0; /* Light text */
            border-color: #4a5568; /* Darker border */
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div class="container">
        <h1 class="text-3xl font-bold mb-6">Sergi Erişilebilirlik Uygulaması</h1>
        <p class="text-gray-300 mb-6">Sergi ziyaretinizi kolaylaştırmak için tasarlanmış özellikler.</p>

        <div id="welcomeMessage" class="bg-blue-900/50 p-4 rounded-lg mb-6 text-blue-200 hidden" role="status" aria-live="polite">
            <p class="font-semibold">Hoş geldiniz!</p>
            <p>Bu uygulama görselleri sesli betimler, sorularınızı yanıtlar ve sergi gezintinizi kolaylaştırır. Sesli asistanı başlatmak için aşağıdaki butona tıklayabilirsiniz.</p>
        </div>

        <header class="mb-10">
            <div class="flex flex-wrap justify-center gap-4 mt-10">
                <div class="accessibility-controls flex flex-wrap items-center gap-4 elegant-card p-4 rounded-xl elegant-shadow">
                    <span class="text-gray-300 font-medium">Yazı Boyutu:</span>
                    <button id="decreaseText" class="btn-elegant text-gray-300 font-medium py-2 px-4 rounded-full transition elegant-border">A-</button>
                    <button id="resetText" class="btn-elegant text-gray-300 font-medium py-2 px-4 rounded-full transition elegant-border">A</button>
                    <button id="increaseText" class="btn-elegant text-gray-300 font-medium py-2 px-4 rounded-full transition elegant-border">A+</button>
                    
                    <span class="text-gray-300 font-medium ml-4">Mod:</span>
                    <button id="toggleContrast" class="btn-elegant bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-full transition flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707" />
                        </svg>
                        Yüksek Kontrast
                    </button>
                    
                    <button id="toggleScreenReader" class="btn-elegant bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-full transition flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                        </svg>
                        Ekran Okuyucu Modu
                    </button>
                </div>
            </div>
        </header>
    
        <main>
            <section class="mb-20">
                <h2 class="text-3xl font-bold text-indigo-900 mb-10 text-center">Erişilebilirlik Özellikleri</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="audio-guide">
                        <div class="p-8 flex flex-col items-center text-center">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 001.414 1.414m0 0l-2.828 2.828m0 0a9 9 0 010-12.728m2.828 2.828a5 5 0 00-1.414 1.414" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3">Sesli Rehber</h3>
                            <p class="text-gray-300">Sergi hakkında detaylı sesli açıklamalar ve yönlendirmeler</p>
                            <span class="screen-reader-text">Sesli rehber özelliğini açmak için tıklayın</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="accessible-map">
                        <div class="p-8 flex flex-col items-center text-center">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3">Erişilebilir Harita</h3>
                            <p class="text-gray-300">Engelsiz rotaları ve tesisleri gösteren interaktif harita</p>
                            <span class="screen-reader-text">Erişilebilir haritayı görüntülemek için tıklayın</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="artwork-info">
                        <div class="p-8 flex flex-col items-center text-center">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3">Eser Bilgileri</h3>
                            <p class="text-gray-300">Detaylı ve erişilebilir eser açıklamaları ve bilgileri</p>
                            <span class="screen-reader-text">Eser bilgilerini görüntülemek için tıklayın</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="emotion-analysis">
                        <div class="p-8 flex flex-col items-center text-center">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3">Duygu Analizi</h3>
                            <p class="text-gray-300">Eserlerin duygusal tonunu ve yarattığı hissi keşfedin.</p>
                            <span class="screen-reader-text">Duygu analizi özelliğini açmak için tıklayın</span>
                        </div>
                    </div>

                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="qr-scanner">
                        <div class="p-8 flex flex-col items-center text-center">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 11h8V3H3v8zm0 10h8v-8H3v8zm10 0h8v-8h-8v8zm0-10h8V3h-8v8z" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3">QR Kodu Tara</h3>
                            <p class="text-gray-300">Eser bilgilerine hızlıca erişmek için QR kodlarını tarayın.</p>
                            <span class="screen-reader-text">QR kod tarayıcıyı açmak için tıklayın</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="help-support">
                        <div class="p-8 flex flex-col items-center text-center">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3">Yardım ve Destek</h3>
                            <p class="text-gray-300">Acil yardım çağırma ve geri bildirim seçenekleri</p>
                            <span class="screen-reader-text">Yardım ve destek seçeneklerini görüntülemek için tıklayın</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="mb-16">
                <div class="elegant-card rounded-2xl elegant-shadow p-8">
                    <h2 class="text-3xl font-bold text-indigo-900 mb-8 text-center">Güncel Sergiler</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="elegant-border rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h3 class="text-xl font-semibold text-indigo-900 mb-3">Modern Sanat Sergisi</h3>
                            <p class="text-gray-300 mb-4">A Salonu - 1. Kat</p>
                            <span class="inline-block bg-green-50 text-green-700 text-xs px-3 py-1.5 rounded-full font-medium">Tamamen Erişilebilir</span>
                        </div>
                        <div class="elegant-border rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h3 class="text-xl font-semibold text-indigo-900 mb-3">Tarihi Eserler</h3>
                            <p class="text-gray-300 mb-4">B Salonu - 2. Kat</p>
                            <span class="inline-block bg-amber-50 text-amber-700 text-xs px-3 py-1.5 rounded-full font-medium">Kısmen Erişilebilir</span>
                        </div>
                        <div class="elegant-border rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h3 class="text-xl font-semibold text-indigo-900 mb-3">Dijital Sanat</h3>
                            <p class="text-gray-300 mb-4">C Salonu - Giriş Kat</p>
                            <span class="inline-block bg-green-50 text-green-700 text-xs px-3 py-1.5 rounded-full font-medium">Tamamen Erişilebilir</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center text-gray-600 mt-20 pb-8">
            <div class="w-24 h-1 bg-indigo-200 mx-auto mb-6 rounded-full"></div>
            <p>© 2025 Sergi Erişilebilirlik Uygulaması | Tüm Hakları Saklıdır</p>
        </footer>
    </div>

    <div class="voice-assistant-container">
        <div id="voice-assistant-button" class="voice-assistant-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
        </div>
        
        <div id="voice-assistant-panel" class="voice-assistant-panel hidden elegant-shadow">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-indigo-900">Sesli Asistan</h3>
                <button id="close-assistant" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div id="voice-assistant-messages" class="voice-assistant-messages">
                <div class="voice-message assistant-message">
                    <p>Merhaba! Ben sergi asistanınız. Size nasıl yardımcı olabilirim?</p>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <div id="listening-animation" class="listening-animation hidden">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                
                <button id="start-voice" class="btn-elegant bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-full transition flex-grow flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                    </svg>
                    Konuşmaya Başla
                </button>
                
                <button id="type-message" class="btn-elegant bg-white hover:bg-gray-100 text-indigo-600 font-medium p-2 rounded-full transition border border-indigo-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </button>
            </div>
            
            <div id="text-input-area" class="mt-3 hidden">
                <div class="flex gap-2">
                    <input type="text" id="text-message" class="flex-grow px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Mesajınızı yazın...">
                    <button id="send-text" class="btn-elegant bg-indigo-600 hover:bg-indigo-700 text-white font-medium p-2 rounded-full transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="modal-content bg-white rounded-2xl elegant-shadow max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modal-title" class="text-3xl font-bold text-indigo-900"></h2>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div id="modal-content"></div>
            </div>
        </div>
    </div>

    <div id="qrScannerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="qrScannerTitle">
        <div class="modal-content">
            <span class="close-button" id="closeQrScannerModalButton" aria-label="QR tarayıcıyı kapat">&times;</span>
            <h3 id="qrScannerTitle" class="text-xl font-bold mb-4">QR Kodu Tara ✨</h3>
            <p class="mb-4 text-gray-300">Lütfen kameranızı QR koduna doğru tutun.</p>
            <video id="video" playsinline></video>
            <canvas id="canvas" class="hidden"></canvas>
            <p id="qrStatus" class="text-gray-400 mt-2" aria-live="polite">Kamera bekleniyor...</p>
            <p id="qrErrorMessage" class="text-red-500 text-sm mt-2 hidden" role="alert" aria-live="assertive"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Font size adjustment
            const htmlElement = document.documentElement;
            let currentFontSize = 100; // percentage
            
            const increaseTextButton = document.getElementById('increaseText');
            const decreaseTextButton = document.getElementById('decreaseText');
            const resetTextButton = document.getElementById('resetText');

            if (increaseTextButton) {
                increaseTextButton.addEventListener('click', function() {
                    if (currentFontSize < 150) {
                        currentFontSize += 10;
                        htmlElement.style.fontSize = currentFontSize + '%';
                    }
                });
            }
            
            if (decreaseTextButton) {
                decreaseTextButton.addEventListener('click', function() {
                    if (currentFontSize > 70) {
                        currentFontSize -= 10;
                        htmlElement.style.fontSize = currentFontSize + '%';
                    }
                });
            }
            
            if (resetTextButton) {
                resetTextButton.addEventListener('click', function() {
                    currentFontSize = 100;
                    htmlElement.style.fontSize = '100%';
                });
            }
            
            // High contrast mode
            const toggleContrastButton = document.getElementById('toggleContrast');
            if (toggleContrastButton) {
                toggleContrastButton.addEventListener('click', function() {
                    document.body.classList.toggle('high-contrast');
                });
            }
            
            // Screen reader mode
            const toggleScreenReaderButton = document.getElementById('toggleScreenReader');
            if (toggleScreenReaderButton) {
                toggleScreenReaderButton.addEventListener('click', function() {
                    document.body.classList.toggle('screen-reader-mode');
                });
            }
            
            // Modal functionality
            const modalContainer = document.getElementById('modal-container');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const closeModal = document.getElementById('close-modal');
            
            function openModal(title, content) {
                modalTitle.textContent = title;
                modalContent.innerHTML = content;
                if (modalContainer) {
                    modalContainer.classList.remove('hidden');
                    modalContainer.classList.add('flex');
                }
            }
            
            if (closeModal) {
                closeModal.addEventListener('click', function() {
                    if (modalContainer) {
                        modalContainer.classList.add('hidden');
                        modalContainer.classList.remove('flex');
                    }
                });
            }
            
            // Close modal when clicking outside
            if (modalContainer) {
                modalContainer.addEventListener('click', function(e) {
                    if (e.target === modalContainer) {
                        modalContainer.classList.add('hidden');
                        modalContainer.classList.remove('flex');
                    }
                });
            }
            
            // Feature cards
            const featureCards = document.querySelectorAll('.feature-card');
            
            featureCards.forEach(card => {
                if (card) { // Ensure card exists
                    card.addEventListener('click', function() {
                        const feature = this.getAttribute('data-feature');
                        let title, content;
                        
                        switch(feature) {
                            case 'audio-guide':
                                title = 'Sesli Rehber';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-300">Sergi deneyiminizi zenginleştirmek için sesli rehberimizi kullanabilirsiniz. Aşağıdaki sergilerden birini seçerek sesli anlatımı başlatın.</p>
                                        
                                        <div class="bg-gray-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Mevcut Sesli Rehberler</h3>
                                            <ul class="space-y-4">
                                                <li>
                                                    <button class="flex items-center w-full text-left p-4 elegant-border rounded-xl hover:bg-indigo-50 transition">
                                                        <div class="bg-indigo-100 rounded-full p-3 mr-4">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                            </svg>
                                                        </div>
                                                        <div>
                                                            <div class="font-medium text-lg text-indigo-900">Modern Sanat Sergisi</div>
                                                            <div class="text-sm text-gray-400 mt-1">Süre: 25 dakika</div>
                                                        </div>
                                                    </button>
                                                </li>
                                                <li>
                                                    <button class="flex items-center w-full text-left p-4 elegant-border rounded-xl hover:bg-indigo-50 transition">
                                                        <div class="bg-indigo-100 rounded-full p-3 mr-4">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                            </svg>
                                                        </div>
                                                        <div>
                                                            <div class="font-medium text-lg text-indigo-900">Tarihi Eserler</div>
                                                            <div class="text-sm text-gray-400 mt-1">Süre: 40 dakika</div>
                                                        </div>
                                                    </button>
                                                </li>
                                                <li>
                                                    <button class="flex items-center w-full text-left p-4 elegant-border rounded-xl hover:bg-indigo-50 transition">
                                                        <div class="bg-indigo-100 rounded-full p-3 mr-4">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                            </svg>
                                                        </div>
                                                        <div>
                                                            <div class="font-medium text-lg text-indigo-900">Dijital Sanat</div>
                                                            <div class="text-sm text-gray-400 mt-1">Süre: 20 dakika</div>
                                                        </div>
                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                        
                                        <div class="bg-indigo-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Özellikler</h3>
                                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Detaylı eser açıklamaları
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Sanatçı biyografileri
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Tarihsel bağlam bilgileri
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Çoklu dil desteği
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'accessible-map':
                                title = 'Erişilebilir Harita';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-300">Sergi alanında kolayca yön bulmanızı sağlayan erişilebilir haritamız, engelsiz rotaları, asansörleri, rampaları ve diğer erişilebilirlik özelliklerini gösterir.</p>
                                        
                                        <div class="elegant-border rounded-xl p-6 relative">
                                            <svg viewBox="0 0 500 300" class="w-full h-auto">
                                                <rect x="50" y="50" width="400" height="200" fill="#2a4365" stroke="#4299e1" stroke-width="2"/>
                                                
                                                <rect x="70" y="70" width="100" height="80" fill="#4299e1" stroke="#90cdf4" stroke-width="1.5"/>
                                                <text x="120" y="110" text-anchor="middle" font-size="12" fill="#e2e8f0" font-family="Inter">A Salonu</text>
                                                
                                                <rect x="190" y="70" width="100" height="80" fill="#4299e1" stroke="#90cdf4" stroke-width="1.5"/>
                                                <text x="240" y="110" text-anchor="middle" font-size="12" fill="#e2e8f0" font-family="Inter">B Salonu</text>
                                                
                                                <rect x="310" y="70" width="120" height="80" fill="#4299e1" stroke="#90cdf4" stroke-width="1.5"/>
                                                <text x="370" y="110" text-anchor="middle" font-size="12" fill="#e2e8f0" font-family="Inter">C Salonu</text>
                                                
                                                <rect x="70" y="170" width="160" height="60" fill="#4299e1" stroke="#90cdf4" stroke-width="1.5"/>
                                                <text x="150" y="200" text-anchor="middle" font-size="12" fill="#e2e8f0" font-family="Inter">Giriş Salonu</text>
                                                
                                                <path d="M150 230 L150 260 L370 260 L370 150" stroke="#a7f3d0" stroke-width="2.5" stroke-dasharray="5,5" fill="none"/>
                                                
                                                <circle cx="150" cy="240" r="8" fill="#a7f3d0"/>
                                                <text x="150" y="265" text-anchor="middle" font-size="10" fill="#e2e8f0" font-family="Inter">Giriş</text>
                                                
                                                <circle cx="240" cy="90" r="8" fill="#9f7aea"/>
                                                <text x="240" y="90" text-anchor="middle" font-size="10" fill="white" font-family="Inter">i</text>
                                                
                                                <circle cx="370" cy="90" r="8" fill="#9f7aea"/>
                                                <text x="370" y="90" text-anchor="middle" font-size="10" fill="white" font-family="Inter">i</text>
                                                
                                                <circle cx="100" cy="200" r="8" fill="#d53f8c"/>
                                                <text x="100" y="203" text-anchor="middle" font-size="10" fill="white">♿</text>
                                                
                                                <circle cx="200" cy="200" r="8" fill="#d53f8c"/>
                                                <text x="200" y="203" text-anchor="middle" font-size="10" fill="white">🚻</text>
                                                
                                                <circle cx="330" cy="120" r="8" fill="#d53f8c"/>
                                                <text x="330" y="123" text-anchor="middle" font-size="10" fill="white">🚻</text>
                                            </svg>
                                            
                                            <div class="mt-6">
                                                <h3 class="font-medium text-xl mb-4 text-indigo-900">Sembol Açıklamaları</h3>
                                                <div class="grid grid-cols-2 gap-4">
                                                    <div class="flex items-center">
                                                        <div class="w-5 h-5 bg-emerald-500 rounded-full mr-3"></div>
                                                        <span class="text-gray-300">Erişilebilir Giriş</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="w-5 h-5 bg-indigo-600 rounded-full mr-3"></div>
                                                        <span class="text-gray-300">Bilgi Noktası</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="w-5 h-5 bg-purple-500 rounded-full mr-3"></div>
                                                        <span class="text-gray-300">Erişilebilir Tuvalet</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-0 border-t-2 border-dashed border-emerald-500 mr-3"></div>
                                                        <span class="text-gray-300">Erişilebilir Rota</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-indigo-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Erişilebilirlik Bilgileri</h3>
                                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Tüm katlara asansör erişimi
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Erişilebilir tuvaletler
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Tekerlekli sandalye ödünç alma
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Engelsiz park alanları
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'artwork-info':
                                title = 'Eser Bilgileri';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-300">Sergimizdeki eserler hakkında detaylı bilgilere buradan erişebilirsiniz. Her eser için açıklamalar, sanatçı bilgileri ve bağlamsal bilgiler sunulmaktadır.</p>
                                        
                                        <div class="bg-gray-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Öne Çıkan Eserler</h3>
                                            
                                            <div class="space-y-5">
                                                <div class="elegant-border rounded-xl p-5 hover:shadow-md transition-shadow">
                                                    <h4 class="font-medium text-lg text-indigo-900">Mavi Kompozisyon</h4>
                                                    <p class="text-sm text-gray-400 mt-1">Ahmet Yılmaz, 2018</p>
                                                    <p class="mt-3 text-gray-300">Bu eser, sanatçının mavi tonlarını kullanarak yarattığı soyut bir çalışmadır. Eser, deniz ve gökyüzü arasındaki ilişkiyi yansıtmaktadır.</p>
                                                    <button class="mt-4 text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center">
                                                        Detaylı bilgi
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                                        </svg>
                                                    </button>
                                                </div>
                                                
                                                <div class="elegant-border rounded-xl p-5 hover:shadow-md transition-shadow">
                                                    <h4 class="font-medium text-lg text-indigo-900">Zaman ve Mekan</h4>
                                                    <p class="text-sm text-gray-400 mt-1">Zeynep Kaya, 2020</p>
                                                    <p class="mt-3 text-gray-300">Bu heykel çalışması, zamanın ve mekanın akışkanlığını temsil etmektedir. Sanatçı, bronz ve cam malzemeleri kullanarak bu kavramları somutlaştırmıştır.</p>
                                                    <button class="mt-4 text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center">
                                                        Detaylı bilgi
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                                        </svg>
                                                    </button>
                                                </div>
                                                
                                                <div class="elegant-border rounded-xl p-5 hover:shadow-md transition-shadow">
                                                    <h4 class="font-medium text-lg text-indigo-900">Dijital Çağ</h4>
                                                    <p class="text-sm text-gray-400 mt-1">Mehmet Demir, 2022</p>
                                                    <p class="mt-3 text-gray-300">Bu dijital enstalasyon, teknolojinin insan yaşamına etkisini interaktif bir şekilde ele almaktadır. Ziyaretçiler, eserin bir parçası haline gelerek deneyimi tamamlamaktadır.</p>
                                                    <button class="mt-4 text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center">
                                                        Detaylı bilgi
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-indigo-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Erişilebilirlik Özellikleri</h3>
                                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Braille alfabesi ile yazılmış açıklamalar
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Sesli açıklamalar
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Dokunsal reprodüksiyonlar
                                                </li>
                                                <li class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    İşaret dili videoları
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'emotion-analysis': // New case for Emotion Analysis
                                title = 'Duygu Analizi';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-300">Bu özellik, yüklediğiniz görselin duygusal tonunu ve izleyicide uyandırabileceği hisleri yapay zeka aracılığıyla analiz eder.</p>
                                        <div class="elegant-border rounded-xl p-6">
                                            <p class="text-gray-300">Lütfen bir görsel yükleyin veya QR kodu tarayarak bir eser seçin. Duygu analizi otomatik olarak yapılacaktır.</p>
                                            <div id="modalEmotionOutput" class="mt-4 p-4 rounded-lg text-left hidden" role="region">
                                                <p class="font-medium text-pink-400 mb-2">Analiz Sonucu:</p>
                                                <p id="modalEmotionText" class="whitespace-pre-wrap text-gray-300"></p>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'qr-scanner': // New case for QR Scanner
                                title = 'QR Kodu Tara';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-300">Sergideki eserlerin QR kodlarını tarayarak anında bilgilere ulaşın.</p>
                                        <div class="elegant-border rounded-xl p-6">
                                            <p class="text-gray-300">QR tarayıcıyı başlatmak için aşağıdaki butona tıklayın.</p>
                                            <button id="startModalQrScannerButton" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 mt-4 w-full">
                                                QR Tarayıcıyı Başlat
                                            </button>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'help-support':
                                title = 'Yardım ve Destek';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-300">Sergi ziyaretiniz sırasında herhangi bir yardıma ihtiyacınız olursa, aşağıdaki seçenekleri kullanabilirsiniz.</p>
                                        
                                        <div class="bg-red-50 p-6 rounded-xl border border-red-100">
                                            <h3 class="font-medium text-xl text-red-800 mb-3">Acil Yardım</h3>
                                            <p class="mb-4 text-gray-300">Acil bir durumda hemen personelimize ulaşmak için aşağıdaki düğmeyi kullanabilirsiniz.</p>
                                            <button class="bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-6 rounded-xl flex items-center justify-center w-full transition shadow-sm hover:shadow">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                Acil Yardım Çağır
                                            </button>
                                        </div>
                                        
                                        <div class="bg-gray-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">İletişim Seçenekleri</h3>
                                            
                                            <div class="space-y-4">
                                                <div class="flex items-center p-4 elegant-border rounded-xl hover:bg-gray-50 transition">
                                                    <div class="bg-indigo-100 rounded-full p-3 mr-4">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                                        </svg>
                                                    </div>
                                                    <div>
                                                        <div class="font-medium text-lg text-indigo-900">Telefon</div>
                                                        <div class="text-gray-400 mt-1">0212 123 45 67</div>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-center p-4 elegant-border rounded-xl hover:bg-gray-50 transition">
                                                    <div class="bg-indigo-100 rounded-full p-3 mr-4">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                        </svg>
                                                    </div>
                                                    <div>
                                                        <div class="font-medium text-lg text-indigo-900">E-posta</div>
                                                        <div class="text-gray-400 mt-1">destek@sergi.com</div>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-center p-4 elegant-border rounded-xl hover:bg-gray-50 transition">
                                                    <div class="bg-indigo-100 rounded-full p-3 mr-4">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z" />
                                                        </svg>
                                                    </div>
                                                    <div>
                                                        <div class="font-medium text-lg text-indigo-900">Canlı Sohbet</div>
                                                        <div class="text-gray-400 mt-1">Hemen başlat</div>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-indigo-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Geri Bildirim</h3>
                                            <p class="mb-4 text-gray-300">Deneyiminizi iyileştirmemize yardımcı olmak için geri bildirimde bulunabilirsiniz.</p>
                                            
                                            <div class="space-y-4">
                                                <div>
                                                    <label for="feedback-name" class="block text-sm font-medium text-gray-300 mb-2">Adınız</label>
                                                    <input type="text" id="feedback-name" class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                                                </div>
                                                
                                                <div>
                                                    <label for="feedback-message" class="block text-sm font-medium text-gray-300 mb-2">Mesajınız</label>
                                                    <textarea id="feedback-message" rows="3" class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                                                </div>
                                                
                                                <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-6 rounded-xl w-full transition shadow-sm hover:shadow">Gönder</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                break;
                        }
                        
                        openModal(title, content);

                        // If the opened modal is for QR Scanner, attach event listener
                        if (feature === 'qr-scanner') {
                            const startModalQrScannerButton = document.getElementById('startModalQrScannerButton');
                            if (startModalQrScannerButton) {
                                startModalQrScannerButton.addEventListener('click', () => {
                                    // Close the main modal first
                                    if (modalContainer) {
                                        modalContainer.classList.add('hidden');
                                        modalContainer.classList.remove('flex');
                                    }
                                    // Then open the QR scanner modal
                                    if (openQrScannerButton) {
                                        openQrScannerButton.click();
                                    }
                                });
                            }
                        }
                    });
                }
            });
            
            // Voice Assistant Functionality
            const voiceAssistantButton = document.getElementById('voice-assistant-button');
            const voiceAssistantPanel = document.getElementById('voice-assistant-panel');
            const closeAssistant = document.getElementById('close-assistant');
            const startVoiceButton = document.getElementById('start-voice');
            const typeMessageButton = document.getElementById('type-message');
            const textInputArea = document.getElementById('text-input-area');
            const textMessage = document.getElementById('text-message');
            const sendTextButton = document.getElementById('send-text');
            const voiceAssistantMessages = document.getElementById('voice-assistant-messages');
            const listeningAnimation = document.getElementById('listening-animation');
            
            // Toggle voice assistant panel
            if (voiceAssistantButton) {
                voiceAssistantButton.addEventListener('click', function() {
                    if (voiceAssistantPanel) {
                        voiceAssistantPanel.classList.toggle('hidden');
                        if (!voiceAssistantPanel.classList.contains('hidden')) {
                            voiceAssistantButton.classList.add('pulse-animation');
                        } else {
                            voiceAssistantButton.classList.remove('pulse-animation');
                        }
                    }
                });
            }
            
            if (closeAssistant) {
                closeAssistant.addEventListener('click', function() {
                    if (voiceAssistantPanel) {
                        voiceAssistantPanel.classList.add('hidden');
                        voiceAssistantButton.classList.remove('pulse-animation');
                    }
                });
            }
            
            // Toggle text input area
            if (typeMessageButton) {
                typeMessageButton.addEventListener('click', function() {
                    if (textInputArea) {
                        textInputArea.classList.toggle('hidden');
                        if (!textInputArea.classList.contains('hidden') && textMessage) {
                            textMessage.focus();
                        }
                    }
                });
            }
            
            // Send text message
            function sendMessage(message) {
                // Add user message to chat
                if (voiceAssistantMessages) {
                    const userMessageElement = document.createElement('div');
                    userMessageElement.className = 'voice-message user-message';
                    userMessageElement.innerHTML = `<p>${message}</p>`;
                    voiceAssistantMessages.appendChild(userMessageElement);
                    
                    // Scroll to bottom of messages
                    voiceAssistantMessages.scrollTop = voiceAssistantMessages.scrollHeight;
                }
                
                // Process the message and respond (simulated)
                setTimeout(() => {
                    respondToMessage(message);
                }, 1000);
            }
            
            if (sendTextButton) {
                sendTextButton.addEventListener('click', function() {
                    if (textMessage) {
                        const message = textMessage.value.trim();
                        if (message) {
                            sendMessage(message);
                            textMessage.value = '';
                        }
                    }
                });
            }
            
            if (textMessage) {
                textMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const message = textMessage.value.trim();
                        if (message) {
                            sendMessage(message);
                            textMessage.value = '';
                        }
                    }
                });
            }
            
            // Voice recognition simulation
            if (startVoiceButton) {
                startVoiceButton.addEventListener('click', function() {
                    if (listeningAnimation) {
                        listeningAnimation.classList.remove('hidden');
                    }
                    if (startVoiceButton) {
                        startVoiceButton.textContent = 'Dinleniyor...';
                        startVoiceButton.disabled = true;
                    }
                    
                    // Simulate voice recognition (in a real app, this would use the Web Speech API)
                    setTimeout(() => {
                        const simulatedVoiceCommands = [
                            "Modern Sanat Sergisi nerede?",
                            "En yakın tuvalet nerede?",
                            "Dijital Sanat sergisi hakkında bilgi verir misin?",
                            "Tekerlekli sandalye nereden alabilirim?"
                        ];
                        
                        const randomCommand = simulatedVoiceCommands[Math.floor(Math.random() * simulatedVoiceCommands.length)];
                        sendMessage(randomCommand);
                        
                        if (listeningAnimation) {
                            listeningAnimation.classList.add('hidden');
                        }
                        if (startVoiceButton) {
                            startVoiceButton.innerHTML = `
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                                </svg>
                                Konuşmaya Başla
                            `;
                            startVoiceButton.disabled = false;
                        }
                    }, 2000);
                });
            }
            
            // Respond to user messages
            function respondToMessage(message) {
                let response = '';
                
                // Simple pattern matching for responses
                message = message.toLowerCase();
                
                if (message.includes('merhaba') || message.includes('selam')) {
                    response = 'Merhaba! Size nasıl yardımcı olabilirim?';
                } else if (message.includes('modern sanat') || message.includes('modern')) {
                    response = 'Modern Sanat Sergisi A Salonunda, 1. katta bulunmaktadır. Asansör veya merdivenlerden ulaşabilirsiniz.';
                } else if (message.includes('tarihi eser') || message.includes('tarihi')) {
                    response = 'Tarihi Eserler Sergisi B Salonunda, 2. katta bulunmaktadır. Asansör veya merdivenlerden ulaşabilirsiniz.';
                } else if (message.includes('dijital') || message.includes('dijital sanat')) {
                    response = 'Dijital Sanat Sergisi C Salonunda, giriş katta bulunmaktadır. Bu sergide interaktif dijital enstalasyonlar yer almaktadır.';
                } else if (message.includes('tuvalet') || message.includes('wc')) {
                    response = 'En yakın tuvaletler giriş katında, Giriş Salonunun sağ tarafında bulunmaktadır. Ayrıca her katta erişilebilir tuvaletler mevcuttur.';
                } else if (message.includes('tekerlekli sandalye')) {
                    response = 'Tekerlekli sandalye ödünç almak için giriş katındaki bilgi masasına başvurabilirsiniz. Ücretsiz olarak hizmetinizdedir.';
                } else if (message.includes('yardım') || message.includes('destek')) {
                    response = 'Size nasıl yardımcı olabilirim? Sergi hakkında bilgi, yön tarifi veya erişilebilirlik özellikleri konusunda sorularınızı yanıtlayabilirim.';
                } else if (message.includes('teşekkür')) {
                    response = 'Rica ederim! Başka bir sorunuz olursa yardımcı olmaktan memnuniyet duyarım.';
                } else {
                    response = 'Bu konuda size yardımcı olabilmek için daha fazla bilgiye ihtiyacım var. Lütfen sorunuzu daha detaylı bir şekilde belirtir misiniz?';
                }
                
                // Add assistant response to chat
                if (voiceAssistantMessages) {
                    const assistantMessageElement = document.createElement('div');
                    assistantMessageElement.className = 'voice-message assistant-message';
                    assistantMessageElement.innerHTML = `<p>${response}</p>`;
                    voiceAssistantMessages.appendChild(assistantMessageElement);
                    
                    // Scroll to bottom of messages
                    voiceAssistantMessages.scrollTop = voiceAssistantMessages.scrollHeight;
                }
            }

            // --- Existing Image-to-Audio-Description Logic (adapted) ---
            const imageUpload = document.getElementById('imageUpload');
            const fileNameSpan = document.getElementById('fileName');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const describeImageButton = document.getElementById('describeImageButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const descriptionOutput = document.getElementById('descriptionOutput');
            const descriptionText = document.getElementById('descriptionText');
            const copyDescriptionButton = document.getElementById('copyDescriptionButton');
            const audioPlayerContainer = document.getElementById('audioPlayerContainer');
            const audioPlayer = document.getElementById('audioPlayer');
            const errorMessage = document.getElementById('errorMessage');

            const openAskQuestionModalButton = document.getElementById('openAskQuestionModalButton');
            const askQuestionModal = document.getElementById('askQuestionModal');
            const closeAskQuestionModalButton = document.getElementById('closeAskQuestionModalButton');
            const questionInput = document.getElementById('questionInput');
            const answerQuestionButton = document.getElementById('answerQuestionButton');
            const answerQuestionButtonText = document.getElementById('answerQuestionButtonText');
            const answerQuestionSpinner = document.getElementById('answerQuestionSpinner');
            const questionOutput = document.getElementById('questionOutput');
            const answerText = document.getElementById('answerText');
            const copyAnswerButton = document.getElementById('copyAnswerButton');
            const questionErrorMessage = document.getElementById('questionErrorMessage');

            const analyzeEmotionButton = document.getElementById('analyzeEmotionButton');
            const emotionalOutput = document.getElementById('emotionalOutput');
            const emotionalText = document.getElementById('emotionalText');
            const copyEmotionalButton = document.getElementById('copyEmotionalButton');

            const getArtworkInfoButton = document.getElementById('getArtworkInfoButton');
            const artworkInfoOutput = document.getElementById('artworkInfoOutput');
            const artworkInfoText = document.getElementById('artworkInfoText');
            const copyArtworkInfoButton = document.getElementById('copyArtworkInfoButton');

            const showSignLanguageButton = document.getElementById('showSignLanguageButton');
            const signLanguageVideoContainer = document.getElementById('signLanguageVideoContainer');

            const toggleVoiceAssistantButton = document.getElementById('toggleVoiceAssistantButton');
            const voiceAssistantButtonText = document.getElementById('voiceAssistantButtonText');
            const voiceAssistantStatus = document.getElementById('voiceAssistantStatus');
            const micIcon = document.getElementById('micIcon');

            const descriptionLevelSelect = document.getElementById('descriptionLevel');
            const welcomeMessageDiv = document.getElementById('welcomeMessage');

            // QR Scanner elements
            const openQrScannerButton = document.getElementById('openQrScannerButton');
            const qrScannerModal = document.getElementById('qrScannerModal');
            const closeQrScannerModalButton = document.getElementById('closeQrScannerModalButton');
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const qrStatus = document.getElementById('qrStatus');
            const qrErrorMessage = document.getElementById('qrErrorMessage');
            let videoStream = null;
            let animationFrameId = null;

            // Dummy artwork database (replace with Firestore in a real app)
            const artworkDatabase = {
                "qr-artwork-123": {
                    imageUrl: "https://placehold.co/400x300/A020F0/FFFFFF?text=Soyut+Sanat",
                    description: "Bu soyut eser, mor ve turuncu tonlarında canlı fırça darbeleriyle dolu, enerjik ve gizemli bir atmosfer sunuyor. Fırça darbeleri, izleyiciyi derin düşüncelere sevk eden karmaşık bir doku oluşturuyor. Eser, soyut dışavurumculuğun gücünü yansıtıyor.",
                    emotionalAnalysis: "Bu eser, güçlü ve çarpıcı renklerin kullanımıyla bir coşku ve merak duygusu uyandırıyor. Morun gizemi ve turuncunun enerjisi, izleyicide hem huzur hem de heyecan karışımı bir his bırakıyor.",
                    artworkInfo: "Eser Adı: 'Mor ve Turuncu Rüyalar'. Sanatçı: Bilinmiyor. Dönem: Çağdaş Sanat. Bu eser, sanatçının iç dünyasındaki zıtlıkları ve uyumu keşfetme çabasını temsil ediyor."
                },
                "qr-artwork-456": {
                    imageUrl: "https://placehold.co/400x300/008080/FFFFFF?text=Manzara",
                    description: "Bu manzara resmi, sakin bir göl kenarında, yeşilin farklı tonlarında ağaçlarla çevrili huzurlu bir sahneyi betimliyor. Gökyüzü açık ve berrak, suyun yüzeyi hafif dalgalanmalarla parlıyor. Uzakta görünen dağlar, derinlik ve dinginlik katıyor.",
                    emotionalAnalysis: "Bu eser, doğanın dinginliğini ve huzurunu yansıtıyor. Yeşil ve mavinin sakinleştirici tonları, izleyicide rahatlama ve dinginlik hissi uyandırıyor. Eser, kaçış ve huzur arayışını temsil ediyor.",
                    artworkInfo: "Eser Adı: 'Sakin Göl'. Sanatçı: Ayşe Yılmaz. Dönem: Romantizm akımından etkilenmiş, 19. yüzyıl sonları. Sanatçı, doğanın insan üzerindeki iyileştirici gücünü vurgulamayı amaçlamıştır."
                }
            };


            let base64ImageData = null;
            let mimeType = null;
            let isListening = false;
            let recognition;
            let lastSpokenText = "";

            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'tr-TR';
                    window.speechSynthesis.speak(utterance);
                    lastSpokenText = text;
                } else {
                    console.warn('Tarayıcınız metin okuma özelliğini desteklemiyor.');
                }
            };

            const resetUI = () => {
                // Reset elements from the original index (3).html
                // (No specific elements to reset here, as they are part of modal content)

                // Reset elements from the image-to-audio-description features
                if (fileNameSpan) fileNameSpan.textContent = 'Görsel Seçin veya Sürükleyin';
                if (imagePreviewContainer) imagePreviewContainer.classList.add('hidden');
                if (imagePreview) imagePreview.src = '#';
                base64ImageData = null;
                mimeType = null;
                if (describeImageButton) describeImageButton.disabled = true;
                if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;
                if (descriptionOutput) descriptionOutput.classList.add('hidden');
                if (emotionalOutput) emotionalOutput.classList.add('hidden');
                if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                if (errorMessage) errorMessage.classList.add('hidden');
                if (questionOutput) questionOutput.classList.add('hidden');
                if (questionInput) questionInput.value = '';
                if (askQuestionModal) askQuestionModal.style.display = 'none';
                lastSpokenText = "";
                speak('Uygulama temizlendi. Yeni bir görsel yükleyebilirsiniz.');
            };

            // Welcome message on load - now also hides itself after speaking
            window.addEventListener('DOMContentLoaded', () => {
                const welcomeText = "Hoş geldiniz! Bu uygulama görselleri sesli betimler ve sorularınızı yanıtlar. Sergi gezintinizi kolaylaştırmak için QR kod tarayıcı ve diğer erişilebilirlik özelliklerini kullanabilirsiniz. Sesli asistanı başlatmak için aşağıdaki butona tıklayabilirsiniz.";
                if (welcomeMessageDiv) {
                    welcomeMessageDiv.classList.remove('hidden');
                    speak(welcomeText);

                    setTimeout(() => {
                        if (welcomeMessageDiv) welcomeMessageDiv.classList.add('hidden');
                    }, 10000);
                }
            });


            if (imageUpload) {
                imageUpload.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        if (fileNameSpan) fileNameSpan.textContent = file.name;
                        mimeType = file.type;
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            if (imagePreview) imagePreview.src = e.target.result;
                            if (imagePreviewContainer) imagePreviewContainer.classList.remove('hidden');
                            base64ImageData = e.target.result.split(',')[1];
                            // Enable buttons related to image processing
                            if (describeImageButton) describeImageButton.disabled = false;
                            if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                            if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                            if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                            speak('Görsel yüklendi. Artık betimleyebilir, soru sorabilir, duygu analizi yapabilir veya sanatçı bilgisi alabilirsiniz.');
                        };
                        reader.readAsDataURL(file);
                    } else {
                        resetUI();
                        speak('Görsel yükleme iptal edildi veya dosya seçilmedi.');
                    }
                });
            }

            const fileInputLabel = document.querySelector('.file-input-label');
            if (fileInputLabel) {
                fileInputLabel.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInputLabel.classList.add('border-indigo-500');
                });
                fileInputLabel.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInputLabel.classList.remove('border-indigo-500');
                });
                fileInputLabel.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInputLabel.classList.remove('border-indigo-500');
                    const files = e.dataTransfer.files;
                    if (files.length > 0 && imageUpload) {
                        imageUpload.files = files;
                        imageUpload.dispatchEvent(new Event('change'));
                    }
                });
            }

            if (describeImageButton) {
                describeImageButton.addEventListener('click', async () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'Lütfen önce bir görsel yükleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Lütfen önce bir görsel yükleyin.');
                        return;
                    }

                    // Hide all output sections before new processing
                    if (descriptionOutput) descriptionOutput.classList.add('hidden');
                    if (emotionalOutput) emotionalOutput.classList.add('hidden');
                    if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                    if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                    if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                    if (errorMessage) errorMessage.classList.add('hidden');

                    // Disable all processing buttons during operation
                    if (describeImageButton) describeImageButton.disabled = true;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;
                    
                    if (buttonText) buttonText.textContent = 'Betimleniyor...';
                    if (loadingSpinner) loadingSpinner.classList.remove('hidden');
                    if (questionOutput) questionOutput.classList.add('hidden');
                    speak('Görsel betimleniyor, lütfen bekleyin.');

                    const descriptionLevel = descriptionLevelSelect ? descriptionLevelSelect.value : 'simple';
                    let prompt = "";

                    if (descriptionLevel === 'simple') {
                        prompt = "Bu görselde ne görüyorsun? Bir sergideki sanat eseri gibi, ana öğeleri, genel atmosferi ve renklerin yarattığı hissi vurgulayarak kısa ve öz bir şekilde betimle. Görme engelli bir bireye sergide rehberlik ediyormuş gibi anlat. Renkleri doğrudan isimleriyle belirtmek yerine, tonlarını ve yarattıkları etkiyi ön plana çıkar (örneğin 'canlı ve sıcak tonlar', 'derin ve melankolik maviler' gibi). Yaklaşık 1 dakikalık bir anlatım olacak şekilde optimize et.";
                    } else { // complex
                        prompt = "Bu görselde ne görüyorsun? Bir sanat eseri gibi çok detaylı, sanatsal ve duygusal bir dille betimle. Görme engelli bir bireye sergide rehberlik ediyormuş gibi anlat. Kompozisyonu, ışık kullanımını, dokuları, figürlerin veya nesnelerin detaylarını ve renklerin yarattığı derinliği ve hissi vurgula. Renkleri doğrudan isimleriyle belirtmek yerine, tonlarını, sıcaklıklarını, soğukluklarını ve yarattıkları etkiyi ön plana çıkararak betimle. Yaklaşık 2 dakikalık bir anlatım olacak şekilde optimize et.";
                    }


                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const description = result.candidates[0].content.parts[0].text;
                            if (descriptionText) descriptionText.textContent = description;
                            if (descriptionOutput) descriptionOutput.classList.remove('hidden');
                            speak(description);

                        } else {
                            if (errorMessage) {
                                errorMessage.textContent = 'Görsel betimlemesi oluşturulamadı. Lütfen tekrar deneyin.';
                                errorMessage.classList.remove('hidden');
                            }
                            speak('Görsel betimlemesi oluşturulamadı. Lütfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('Görsel betimleme hatası:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        // Re-enable all processing buttons
                        if (describeImageButton) describeImageButton.disabled = false;
                        if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                        if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                        if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                        if (buttonText) buttonText.textContent = 'Görseli Betimle';
                        if (loadingSpinner) loadingSpinner.classList.add('hidden');
                    }
                });
            }

            if (copyDescriptionButton) {
                copyDescriptionButton.addEventListener('click', () => {
                    if (descriptionText) {
                        const textToCopy = descriptionText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('Betimleme panoya kopyalandı.');
                            } catch (err) {
                                console.error('Panoya kopyalama başarısız:', err);
                                speak('Betimleme panoya kopyalanamadı.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            if (analyzeEmotionButton) {
                analyzeEmotionButton.addEventListener('click', async () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'Lütfen önce bir görsel yükleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Lütfen önce bir görsel yükleyin.');
                        return;
                    }

                    // Hide all output sections before new processing
                    if (descriptionOutput) descriptionOutput.classList.add('hidden');
                    if (emotionalOutput) emotionalOutput.classList.add('hidden');
                    if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                    if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                    if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                    if (errorMessage) errorMessage.classList.add('hidden');

                    // Disable all processing buttons during operation
                    if (describeImageButton) describeImageButton.disabled = true;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;

                    if (analyzeEmotionButton.querySelector('span')) analyzeEmotionButton.querySelector('span').textContent = 'Analiz Ediliyor...';
                    if (analyzeEmotionButton.querySelector('svg')) analyzeEmotionButton.querySelector('svg').classList.remove('hidden');
                    speak('Duygu analizi yapılıyor, lütfen bekleyin.');

                    const prompt = "Bu görselde hangi duygusal tonu veya ruh halini görüyorsun? Bir sanat eseri olarak bu görselin izleyicide uyandırabileceği ana duyguları ve bu duyguları destekleyen görsel öğeleri (kompozisyon, ışık, figür ifadeleri vb.) sanatsal bir dille betimle. Renkleri doğrudan isimleriyle belirtmek yerine, tonlarını ve yarattıkları etkiyi ön plana çıkar. Sadece duygusal betimlemeyi ver, başka açıklama yapma.";

                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const emotionalDescription = result.candidates[0].content.parts[0].text;
                            if (emotionalText) emotionalText.textContent = emotionalDescription;
                            if (emotionalOutput) emotionalOutput.classList.remove('hidden');
                            speak(emotionalDescription);

                            // Update modal content if it's open
                            const modalEmotionOutput = document.getElementById('modalEmotionOutput');
                            const modalEmotionText = document.getElementById('modalEmotionText');
                            if (modalEmotionOutput && modalEmotionText) {
                                modalEmotionText.textContent = emotionalDescription;
                                modalEmotionOutput.classList.remove('hidden');
                            }

                        } else {
                            if (errorMessage) {
                                errorMessage.textContent = 'Duygu analizi yapılamadı. Lütfen tekrar deneyin.';
                                errorMessage.classList.remove('hidden');
                            }
                            speak('Duygu analizi yapılamadı. Lütfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('Duygu analizi hatası:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        // Re-enable all processing buttons
                        if (describeImageButton) describeImageButton.disabled = false;
                        if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                        if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                        if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                        if (analyzeEmotionButton.querySelector('span')) analyzeEmotionButton.querySelector('span').textContent = 'Duygu Analizi ✨';
                        if (analyzeEmotionButton.querySelector('svg')) analyzeEmotionButton.querySelector('svg').classList.add('hidden');
                    }
                });
            }

            if (copyEmotionalButton) {
                copyEmotionalButton.addEventListener('click', () => {
                    if (emotionalText) {
                        const textToCopy = emotionalText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('Duygu analizi panoya kopyalandı.');
                            } catch (err) {
                                console.error('Panoya kopyalama başarısız:', err);
                                speak('Duygu analizi panoya kopyalanamadı.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            if (getArtworkInfoButton) {
                getArtworkInfoButton.addEventListener('click', async () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'Lütfen önce bir görsel yükleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Lütfen önce bir görsel yükleyin.');
                        return;
                    }

                    // Hide all output sections before new processing
                    if (descriptionOutput) descriptionOutput.classList.add('hidden');
                    if (emotionalOutput) emotionalOutput.classList.add('hidden');
                    if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                    if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                    if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                    if (errorMessage) errorMessage.classList.add('hidden');

                    // Disable all processing buttons during operation
                    if (describeImageButton) describeImageButton.disabled = true;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;

                    if (getArtworkInfoButton.querySelector('span')) getArtworkInfoButton.querySelector('span').textContent = 'Bilgi Alınıyor...';
                    if (getArtworkInfoButton.querySelector('svg')) getArtworkInfoButton.querySelector('svg').classList.remove('hidden');
                    speak('Sanatçı ve eser bilgisi alınıyor, lütfen bekleyin.');

                    const prompt = "Bu görseldeki sanat eseri hakkında bilgi verebilir misin? Sanatçısı kim, eserin adı ne, hangi dönemde veya akımda yapılmış, kısa bir tarihsel veya sanatsal bağlamını açıkla. Görme engelli bir bireye sergide rehberlik ediyormuş gibi anlat. Sadece eserin ve sanatçının bilgisini ver, başka açıklama yapma.";

                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const artworkInfo = result.candidates[0].content.parts[0].text;
                            if (artworkInfoText) artworkInfoText.textContent = artworkInfo;
                            if (artworkInfoOutput) artworkInfoOutput.classList.remove('hidden');
                            speak(artworkInfo);

                        } else {
                            if (errorMessage) {
                                errorMessage.textContent = 'Sanatçı ve eser bilgisi alınamadı. Lütfen tekrar deneyin.';
                                errorMessage.classList.remove('hidden');
                            }
                            speak('Sanatçı ve eser bilgisi alınamadı. Lütfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('Sanatçı ve eser bilgisi hatası:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        // Re-enable all processing buttons
                        if (describeImageButton) describeImageButton.disabled = false;
                        if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                        if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                        if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                        if (getArtworkInfoButton.querySelector('span')) getArtworkInfoButton.querySelector('span').textContent = 'Sanatçı ve Eser Bilgisi ✨';
                        if (getArtworkInfoButton.querySelector('svg')) getArtworkInfoButton.querySelector('svg').classList.add('hidden');
                    }
                });
            }

            if (copyArtworkInfoButton) {
                copyArtworkInfoButton.addEventListener('click', () => {
                    if (artworkInfoText) {
                        const textToCopy = artworkInfoText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('Sanatçı ve eser bilgisi panoya kopyalandı.');
                            } catch (err) {
                                console.error('Panoya kopyalama başarısız:', err);
                                speak('Sanatçı ve eser bilgisi panoya kopyalanamadı.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            // Show Sign Language Placeholder
            if (showSignLanguageButton) {
                showSignLanguageButton.addEventListener('click', () => {
                    if (signLanguageVideoContainer) {
                        if (signLanguageVideoContainer.classList.contains('hidden')) {
                            signLanguageVideoContainer.classList.remove('hidden');
                            speak('Türkçe İşaret Dili betimlemesi gösteriliyor. Bu alanda ilgili görselin işaret dili videosu yer alacaktır.');
                        } else {
                            signLanguageVideoContainer.classList.add('hidden');
                            speak('Türkçe İşaret Dili betimlemesi gizlendi.');
                        }
                    }
                });
            }


            if (openAskQuestionModalButton) {
                openAskQuestionModalButton.addEventListener('click', () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'Lütfen önce bir görsel yükleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Lütfen önce bir görsel yükleyin.');
                        return;
                    }
                    if (questionInput) questionInput.value = '';
                    if (questionOutput) questionOutput.classList.add('hidden');
                    if (questionErrorMessage) questionErrorMessage.classList.add('hidden');
                    if (answerQuestionButton) answerQuestionButton.disabled = false;
                    if (answerQuestionButtonText) answerQuestionButtonText.textContent = 'Cevapla';
                    if (answerQuestionSpinner) answerQuestionSpinner.classList.add('hidden');
                    if (askQuestionModal) askQuestionModal.style.display = 'flex';
                    speak('Görsel hakkında sorunuzu sorabilirsiniz.');
                });
            }

            if (closeAskQuestionModalButton) {
                closeAskQuestionModalButton.addEventListener('click', () => {
                    if (askQuestionModal) askQuestionModal.style.display = 'none';
                    speak('Soru sorma ekranı kapatıldı.');
                });
            }

            window.addEventListener('click', (event) => {
                if (event.target == askQuestionModal && askQuestionModal) {
                    askQuestionModal.style.display = 'none';
                    speak('Soru sorma ekranı kapatıldı.');
                }
            });

            if (answerQuestionButton) {
                answerQuestionButton.addEventListener('click', async () => {
                    const userQuestion = questionInput ? questionInput.value.trim() : '';
                    if (!userQuestion) {
                        if (questionErrorMessage) {
                            questionErrorMessage.textContent = 'Lütfen bir soru girin.';
                            questionErrorMessage.classList.remove('hidden');
                        }
                        speak('Lütfen bir soru girin.');
                        return;
                    }

                    if (answerQuestionButton) answerQuestionButton.disabled = true;
                    if (answerQuestionButtonText) answerQuestionButtonText.textContent = 'Cevaplanıyor...';
                    if (answerQuestionSpinner) answerQuestionSpinner.classList.remove('hidden');
                    if (questionOutput) questionOutput.classList.add('hidden');
                    if (questionErrorMessage) questionErrorMessage.classList.add('hidden');
                    speak('Sorunuz cevaplanıyor, lütfen bekleyin.');

                    const prompt = `Bu görselde ne görüyorsun? Bir sergideki sanat eseri bağlamında, sorulan soruya göre görseli analiz et ve detaylı bir cevap ver. Kullanıcının sorusu bir nesneye veya alana odaklanıyorsa, o nesneyi/alanı özellikle detaylandır. Renkleri doğrudan isimleriyle belirtmek yerine, tonlarını ve yarattıkları etkiyi ön plana çıkar. Soru: "${userQuestion}"`;

                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const answer = result.candidates[0].content.parts[0].text;
                            if (answerText) answerText.textContent = answer;
                            if (questionOutput) questionOutput.classList.remove('hidden');
                            speak(answer);

                        } else {
                            if (questionErrorMessage) {
                                questionErrorMessage.textContent = 'Sorunuza cevap oluşturulamadı. Lütfen tekrar deneyin.';
                                questionErrorMessage.classList.remove('hidden');
                            }
                            speak('Sorunuza cevap oluşturulamadı. Lütfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('Soru cevaplama hatası:', error);
                        if (questionErrorMessage) {
                            questionErrorMessage.textContent = 'Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.';
                            questionErrorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluştu. Lütfen ağ bağlantınızı kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        if (answerQuestionButton) answerQuestionButton.disabled = false;
                        if (answerQuestionButtonText) answerQuestionButtonText.textContent = 'Cevapla';
                        if (answerQuestionSpinner) answerQuestionSpinner.classList.add('hidden');
                    }
                });
            }

            if (copyAnswerButton) {
                copyAnswerButton.addEventListener('click', () => {
                    if (answerText) {
                        const textToCopy = answerText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('Cevap panoya kopyalandı.');
                            } catch (err) {
                                console.error('Panoya kopyalama başarısız:', err);
                                speak('Cevap panoya kopyalanamadı.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'tr-TR';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = () => {
                    isListening = true;
                    if (voiceAssistantButtonText) voiceAssistantButtonText.textContent = 'Dinleniyor...';
                    if (voiceAssistantStatus) {
                        voiceAssistantStatus.textContent = 'Aktif (Dinleniyor...)';
                        voiceAssistantStatus.classList.add('listening');
                    }
                    if (micIcon) micIcon.classList.add('mic-icon-active');
                    console.log('Voice assistant started listening.');
                    speak('Sesli asistan dinlemeye başladı.');
                };

                recognition.onend = () => {
                    isListening = false;
                    if (voiceAssistantButtonText) voiceAssistantButtonText.textContent = 'Sesli Asistanı Başlat';
                    if (voiceAssistantStatus) {
                        voiceAssistantStatus.textContent = 'Kapalı';
                        voiceAssistantStatus.classList.remove('listening');
                    }
                    if (micIcon) micIcon.classList.remove('mic-icon-active');
                    console.log('Voice assistant stopped listening.');
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    if (voiceAssistantStatus) voiceAssistantStatus.textContent = `Hata: ${event.error}`;
                    speak(`Ses tanıma hatası: ${event.error}. Lütfen tekrar deneyin.`);
                    isListening = false;
                    if (voiceAssistantButtonText) voiceAssistantButtonText.textContent = 'Sesli Asistanı Başlat';
                    if (voiceAssistantStatus) voiceAssistantStatus.classList.remove('listening');
                    if (micIcon) micIcon.classList.remove('mic-icon-active');
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    console.log('Tanınan komut:', transcript);
                    if (voiceAssistantStatus) voiceAssistantStatus.textContent = `Komut: "${transcript}"`;
                    processVoiceCommand(transcript);
                };

                if (toggleVoiceAssistantButton) {
                    toggleVoiceAssistantButton.addEventListener('click', () => {
                        if (isListening) {
                            recognition.stop();
                        } else {
                            recognition.start();
                        }
                    });
                }

            } else {
                if (toggleVoiceAssistantButton) toggleVoiceAssistantButton.disabled = true;
                if (voiceAssistantButtonText) voiceAssistantButtonText.textContent = 'Tarayıcınız Sesli Asistanı Desteklemiyor';
                if (voiceAssistantStatus) voiceAssistantStatus.textContent = 'Desteklenmiyor';
                console.warn('Web Speech API (SpeechRecognition) tarayıcınızda desteklenmiyor.');
            }

            const processVoiceCommand = (command) => {
                if (askQuestionModal && askQuestionModal.style.display === 'flex') {
                    if (questionInput) questionInput.value = command;
                    if (answerQuestionButton) answerQuestionButton.click();
                    return;
                }

                if (command.includes('görsel yükle') || command.includes('resim yükle')) {
                    if (imageUpload) imageUpload.click();
                    speak('Görsel yüklemek için dosya seçici açıldı.');
                } else if (command.includes('görseli betimle') || command.includes('betimle')) {
                    if (describeImageButton) describeImageButton.click();
                } else if (command.includes('soru sor') || command.includes('görsel hakkında soru sor')) {
                    if (openAskQuestionModalButton) openAskQuestionModalButton.click();
                } else if (command.includes('duygu analizi yap') || command.includes('duyguları analiz et')) {
                    // Simulate clicking the emotion analysis feature card
                    const emotionAnalysisCard = document.querySelector('[data-feature="emotion-analysis"]');
                    if (emotionAnalysisCard) emotionAnalysisCard.click();
                    // Then trigger the actual analysis if an image is loaded
                    if (base64ImageData && analyzeEmotionButton) {
                        analyzeEmotionButton.click();
                    } else {
                        speak('Lütfen önce bir görsel yükleyin veya QR kodu tarayın.');
                    }
                } else if (command.includes('sanatçı bilgisi ver') || command.includes('eser hakkında bilgi ver')) {
                    // Simulate clicking the artwork info feature card
                    const artworkInfoCard = document.querySelector('[data-feature="artwork-info"]');
                    if (artworkInfoCard) artworkInfoCard.click();
                    // Then trigger the actual info retrieval if an image is loaded
                    if (base64ImageData && getArtworkInfoButton) {
                        getArtworkInfoButton.click();
                    } else {
                        speak('Lütfen önce bir görsel yükleyin veya QR kodu tarayın.');
                    }
                } else if (command.includes('işaret dilini göster') || command.includes('işaret dilini aç')) {
                    if (showSignLanguageButton) showSignLanguageButton.click();
                } else if (command.includes('qr kodu tara') || command.includes('kare kodu oku')) {
                    if (openQrScannerButton) openQrScannerButton.click();
                }
                else if (command.includes('temizle') || command.includes('uygulamayı temizle')) {
                    resetUI();
                } else if (command.includes('tekrar et') || command.includes('sonuncuyu tekrar et')) {
                    if (lastSpokenText) {
                        speak(lastSpokenText);
                    } else {
                        speak('Tekrar edilecek bir şey yok.');
                    }
                } else if (command.includes('basit betimle') || command.includes('kısa betimle')) {
                    if (descriptionLevelSelect) descriptionLevelSelect.value = 'simple';
                    speak('Betimleme seviyesi basite ayarlandı.');
                    if (describeImageButton) describeImageButton.click();
                } else if (command.includes('kapsamlı betimle') || command.includes('detaylı betimle')) {
                    if (descriptionLevelSelect) descriptionLevelSelect.value = 'complex';
                    speak('Betimleme seviyesi kapsamlıya ayarlandı.');
                    if (describeImageButton) describeImageButton.click();
                }
                // Voice commands for existing accessibility features
                else if (command.includes('yazı boyutunu büyüt')) {
                    if (increaseTextButton) increaseTextButton.click();
                    speak('Yazı boyutu büyütüldü.');
                } else if (command.includes('yazı boyutunu küçült')) {
                    if (decreaseTextButton) decreaseTextButton.click();
                    speak('Yazı boyutu küçültüldü.');
                } else if (command.includes('yazı boyutunu sıfırla')) {
                    if (resetTextButton) resetTextButton.click();
                    speak('Yazı boyutu sıfırlandı.');
                } else if (command.includes('yüksek kontrast modunu aç') || command.includes('yüksek kontrast')) {
                    if (toggleContrastButton) toggleContrastButton.click();
                    speak('Yüksek kontrast modu değiştirildi.');
                } else if (command.includes('ekran okuyucu modunu aç') || command.includes('ekran okuyucu')) {
                    if (toggleScreenReaderButton) toggleScreenReaderButton.click();
                    speak('Ekran okuyucu modu değiştirildi.');
                } else if (command.includes('sesli rehberi aç')) {
                    const audioGuideCard = document.querySelector('[data-feature="audio-guide"]');
                    if (audioGuideCard) audioGuideCard.click();
                    speak('Sesli rehber açıldı.');
                } else if (command.includes('erişilebilir haritayı aç')) {
                    const accessibleMapCard = document.querySelector('[data-feature="accessible-map"]');
                    if (accessibleMapCard) accessibleMapCard.click();
                    speak('Erişilebilir harita açıldı.');
                } else if (command.includes('eser bilgilerini aç')) {
                    const artworkInfoCard = document.querySelector('[data-feature="artwork-info"]');
                    if (artworkInfoCard) artworkInfoCard.click();
                    speak('Eser bilgileri açıldı.');
                } else if (command.includes('yardım ve desteği aç')) {
                    const helpSupportCard = document.querySelector('[data-feature="help-support"]');
                    if (helpSupportCard) helpSupportCard.click();
                    speak('Yardım ve destek ekranı açıldı.');
                }
                else {
                    speak('Anlayamadım, lütfen tekrar edin.');
                }
            };

            // --- QR Scanner Logic ---
            let stream; // To hold the camera stream

            if (openQrScannerButton) {
                openQrScannerButton.addEventListener('click', () => {
                    if (qrScannerModal) qrScannerModal.style.display = 'flex';
                    if (qrStatus) qrStatus.textContent = 'Kamera başlatılıyor...';
                    if (qrErrorMessage) qrErrorMessage.classList.add('hidden');
                    speak('QR kod tarayıcı açıldı. Lütfen kameranızı QR koduna doğru tutun.');

                    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }) // Prefer rear camera
                        .then((s) => {
                            stream = s;
                            if (video) {
                                video.srcObject = stream;
                                video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
                                video.play();
                            }
                            requestAnimationFrame(tick);
                            if (qrStatus) qrStatus.textContent = 'Kamera aktif.';
                        })
                        .catch((err) => {
                            console.error("Kamera erişim hatası:", err);
                            if (qrErrorMessage) {
                                qrErrorMessage.textContent = 'Kamera erişimi reddedildi veya kullanılamıyor. Lütfen kamera iznini kontrol edin.';
                                qrErrorMessage.classList.remove('hidden');
                            }
                            if (qrStatus) qrStatus.textContent = 'Kamera hatası.';
                            speak('Kamera erişimi reddedildi veya kullanılamıyor. Lütfen kamera iznini kontrol edin.');
                        });
                });
            }

            if (closeQrScannerModalButton) {
                closeQrScannerModalButton.addEventListener('click', () => {
                    if (qrScannerModal) qrScannerModal.style.display = 'none';
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop()); // Stop camera stream
                        stream = null;
                    }
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                    }
                    if (qrStatus) qrStatus.textContent = 'Kapalı';
                    speak('QR kod tarayıcı kapatıldı.');
                });
            }

            function tick() {
                if (video && video.readyState === video.HAVE_ENOUGH_DATA && canvas) {
                    canvas.hidden = false;
                    let canvasElement = canvas;
                    let canvasContext = canvasElement.getContext("2d");

                    canvasElement.height = video.videoHeight;
                    canvasElement.width = video.videoWidth;
                    canvasContext.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                    let imageData = canvasContext.getImageData(0, 0, canvasElement.width, canvasElement.height);
                    let code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "dontInvert",
                    });

                    if (code) {
                        if (qrStatus) qrStatus.textContent = `QR Kodu Algılandı: ${code.data}`;
                        speak(`QR Kodu algılandı: ${code.data}. Bilgiler yükleniyor.`);
                        processQrCodeData(code.data);
                        if (closeQrScannerModalButton) closeQrScannerModalButton.click(); // Close scanner after successful scan
                        return; // Stop further scanning
                    } else {
                        if (qrStatus) qrStatus.textContent = 'QR kodu taranıyor...';
                    }
                }
                animationFrameId = requestAnimationFrame(tick);
            }

            function processQrCodeData(qrData) {
                // This is where you'd typically fetch data from a backend (e.g., Firestore)
                // based on the qrData (which would be an artwork ID).
                // For this example, we use a dummy local database.

                const artwork = artworkDatabase[qrData];

                if (artwork) {
                    // Simulate loading the image (if you had the actual image URL)
                    if (imagePreview) imagePreview.src = artwork.imageUrl; // Use dummy image URL
                    if (imagePreviewContainer) imagePreviewContainer.classList.remove('hidden');
                    if (fileNameSpan) fileNameSpan.textContent = `QR Kodu ile Yüklendi: ${qrData}`;
                    base64ImageData = null; // Clear base64 as we don't have it from QR scan directly
                    mimeType = 'image/jpeg'; // Assume a default mime type for dummy image

                    // Update main output sections
                    if (descriptionText) descriptionText.textContent = artwork.description;
                    if (descriptionOutput) descriptionOutput.classList.remove('hidden');
                    
                    if (emotionalText) emotionalText.textContent = artwork.emotionalAnalysis;
                    if (emotionalOutput) emotionalOutput.classList.remove('hidden');

                    if (artworkInfoText) artworkInfoText.textContent = artwork.artworkInfo;
                    if (artworkInfoOutput) artworkInfoOutput.classList.remove('hidden');

                    speak(artwork.description); // Speak the description first

                    // Enable all processing buttons as if an image was manually loaded
                    if (describeImageButton) describeImageButton.disabled = false;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                    if (errorMessage) errorMessage.classList.add('hidden'); // Clear any previous errors
                    speak('Eser bilgileri yüklendi.');

                } else {
                    if (errorMessage) {
                        errorMessage.textContent = `Bu QR kodu için eser bilgisi bulunamadı: ${qrData}.`;
                        errorMessage.classList.remove('hidden');
                    }
                    speak(`Bu QR kodu için eser bilgisi bulunamadı: ${qrData}.`);
                    resetUI(); // Clear everything if artwork not found
                }
            }
        });
    </script>
</body>
</html>
