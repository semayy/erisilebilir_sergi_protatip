<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sergi EriÅŸilebilirlik UygulamasÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.0.0/dist/jsQR.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* White background */
            color: #333333; /* Dark text for contrast */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            background-color: #ffffff; /* Pure white for container */
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Lighter shadow */
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif; /* More distinguished heading font */
            color: #dc2626; /* Red accent for headings */
        }
        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem 1.5rem;
            border: 2px dashed #fca5a5; /* Light red border */
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ef4444; /* Red text */
        }
        .file-input-label:hover {
            border-color: #ef4444; /* Darker red on hover */
            color: #b91c1c; /* Even darker red on hover */
        }
        .file-input-label svg {
            margin-right: 0.5rem;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #dc2626; /* Red spinner */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); /* Lighter overlay */
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #ffffff; /* White modal content */
            margin: auto;
            padding: 30px;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 90%;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            color: #333333; /* Dark text */
        }

        .close-button {
            color: #6b7280; /* Dark gray close button */
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #1f2937; /* Even darker on hover */
            text-decoration: none;
            cursor: pointer;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .voice-assistant-status {
            font-size: 0.875rem;
            margin-top: 0.5rem;
            color: #6b7280;
        }
        .voice-assistant-status.listening {
            color: #22c55e; /* Green for listening */
            font-weight: 600;
        }
        .copy-button {
            background-color: #10b981; /* Green */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        .copy-button:hover {
            background-color: #059669; /* Darker green on hover */
        }
        /* Output boxes */
        #descriptionOutput, #emotionalOutput, #artworkInfoOutput, #questionOutput {
            background-color: #fef2f2; /* Very light red/pink */
            border: 1px solid #ef4444; /* Red border */
            color: #333333; /* Dark text */
        }
        #descriptionTitle, #emotionalTitle, #artworkInfoTitle, #answerTitle {
            color: #dc2626; /* Red for titles */
        }
        /* Input fields */
        textarea, select {
            background-color: #f3f4f6; /* Light gray for inputs */
            color: #333333; /* Dark text */
            border-color: #e5e7eb;
        }
        textarea::placeholder {
            color: #9ca3af;
        }
        textarea:focus, select:focus {
            border-color: #dc2626; /* Red focus */
            ring-color: #f87171; /* Lighter red ring */
        }
        /* Buttons */
        .btn-outline {
            background-color: #ffffff; /* White background */
            border: 2px solid; /* Border will be set by color utility */
            color: inherit; /* Text color will be set by color utility */
            transition: all 0.3s ease;
        }
        .btn-outline:hover {
            color: white; /* Text color becomes white on hover */
        }

        /* Specific button colors and hover effects */
        .btn-red { border-color: #dc2626; color: #dc2626; }
        .btn-red:hover { background-color: #dc2626; }

        .btn-purple { border-color: #ef4444; color: #ef4444; }
        .btn-purple:hover { background-color: #ef4444; }

        .btn-pink { border-color: #f43f5e; color: #f43f5e; }
        .btn-pink:hover { background-color: #f43f5e; }

        .btn-green { border-color: #22c55e; color: #22c55e; }
        .btn-green:hover { background-color: #22c55e; }

        .btn-blue { border-color: #3b82f6; color: #3b82f6; }
        .btn-blue:hover { background-color: #3b82f6; }

        .btn-yellow { border-color: #f59e0b; color: #f59e0b; }
        .btn-yellow:hover { background-color: #f59e0b; }
        
        .btn-gray { border-color: #6b7280; color: #6b7280; }
        .btn-gray:hover { background-color: #6b7280; }

        .text-red-500 { color: #ef4444; } /* Red for errors */
        .mic-icon-active { color: #ef4444; } /* Red for active mic */
        .sign-language-video-placeholder {
            background-color: #fef2f2; /* Very light red/pink */
            border: 2px dashed #ef4444; /* Red border */
            color: #dc2626; /* Red text */
        }
        /* QR Scanner specific styles */
        #qrScannerModal .modal-content {
            max-width: 400px;
        }
        #video {
            background-color: #1a202c; /* Dark background for video */
        }

        /* Styles from the provided index (3).html - adapted for new theme */
        .elegant-card {
            background-color: #ffffff; /* White background for cards */
            backdrop-filter: blur(5px);
            color: #333333; /* Dark text */
        }
        .elegant-border {
            border: 1px solid #e5e7eb; /* Light gray border */
        }
        .elegant-shadow {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Lighter shadow */
        }
        /* Icon container styles removed as icons are removed */
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2); /* Lighter hover shadow */
        }
        .voice-assistant-panel {
            background-color: #ffffff; /* White panel */
            color: #333333;
            position: fixed;
            bottom: 6rem;
            right: 1rem;
            width: 90%;
            max-width: 350px;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(100%);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            z-index: 999;
        }
        .voice-assistant-panel.active {
            transform: translateY(0);
            opacity: 1;
        }
        .voice-assistant-messages {
            background-color: #f3f4f6; /* Light gray for messages */
            border-radius: 0.5rem;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        .assistant-message {
            background-color: #fee2e2; /* Very light red for assistant */
            color: #333333;
            padding: 0.75rem;
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            align-self: flex-start;
            text-align: left;
        }
        .user-message {
            background-color: #ef4444; /* Red for user */
            color: #ffffff;
            padding: 0.75rem;
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            align-self: flex-end;
            text-align: right;
        }
        .listening-animation span {
            background-color: #dc2626; /* Red animation bars */
        }

        .voice-assistant-button {
            position: fixed; /* Ensures it stays in place */
            bottom: 1rem; /* Distance from bottom */
            right: 1rem; /* Distance from right */
            background-color: #dc2626; /* Red button */
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
            z-index: 1000; /* Ensures it's on top of other content */
        }
        .voice-assistant-button:hover {
            background-color: #b91c1c; /* Darker red on hover */
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } /* Red pulse */
            70% { box-shadow: 0 0 0 15px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }

        /* Ensure all text is dark on light backgrounds */
        .text-gray-300, .text-gray-400, .text-gray-500, .text-gray-600, .text-gray-700, .text-gray-800, .text-indigo-900 {
            color: #333333 !important;
        }
        /* Specific overrides for status texts to keep their meaning */
        .text-green-700 { color: #16a34a !important; }
        .text-amber-700 { color: #d97706 !important; }
        .text-red-800 { color: #b91c1c !important; }
        .text-blue-200 { color: #2563eb !important; } /* Blue for welcome message */
        .text-blue-300 { color: #2563eb !important; } /* Blue for description title */
        .text-pink-300 { color: #e11d48 !important; } /* Pink for emotional title */
        .text-purple-300 { color: #8b5cf6 !important; } /* Purple for artwork info title (kept purple as it's not a primary red tone) */
        .text-green-300 { color: #16a34a !important; } /* Green for answer title */
        .text-indigo-600 { color: #dc2626 !important; } /* Red for links/buttons */
        .text-indigo-700 { color: #b91c1c !important; } /* Darker red for links/buttons */
        .hover\:bg-indigo-50:hover { background-color: #f3f4f6 !important; } /* Light gray hover for lists */
        .btn-elegant {
            background-color: #f3f4f6; /* Light gray for elegant buttons */
            color: #333333;
            border-color: #e5e7eb;
        }
        .btn-elegant:hover {
            background-color: #e5e7eb; /* Lighter gray on hover */
            color: #1f2937;
        }
        /* High contrast mode buttons */
        .high-contrast .btn-outline {
            border-color: #fff !important;
            color: #fff !important;
            background-color: #000 !important;
        }
        .high-contrast .btn-outline:hover {
            background-color: #333 !important;
        }
        .high-contrast .bg-indigo-900 { background-color: #000 !important; color: #fff !important; } /* High contrast button */
        .high-contrast .bg-indigo-700 { background-color: #000 !important; color: #fff !important; } /* High contrast button */

        /* Footer styling */
        footer {
            color: #6b7280; /* Darker gray for footer text */
        }
        footer .bg-indigo-200 {
            background-color: #ef4444; /* Red line in footer */
        }

        /* Screen reader mode styling */
        .screen-reader-mode .screen-reader-text {
            background: #e5e7eb; /* Light gray background for screen reader text */
            color: #333333; /* Dark text */
            border-color: #9ca3af; /* Medium gray border */
        }

        /* Tab specific styles */
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-bottom: 2px solid transparent;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
        }
        .tab-button.active {
            border-color: #dc2626; /* Red active tab */
            color: #dc2626;
        }
        .tab-button:hover {
            color: #dc2626;
        }
        .tab-content {
            display: none;
            padding-top: 1.5rem;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div class="container">
        <h1 class="text-3xl font-bold mb-6">Sergi EriÅŸilebilirlik UygulamasÄ±</h1>
        <p class="text-gray-700 mb-6">Sergi ziyaretinizi kolaylaÅŸtÄ±rmak iÃ§in tasarlanmÄ±ÅŸ Ã¶zellikler.</p>

        <div id="welcomeMessage" class="bg-blue-600/50 p-4 rounded-lg mb-6 text-blue-200 hidden" role="status" aria-live="polite">
            <p class="font-semibold">HoÅŸ geldiniz!</p>
            <p>Bu uygulama gÃ¶rselleri sesli betimler, sorularÄ±nÄ±zÄ± yanÄ±tlar ve sergi gezintinizi kolaylaÅŸtÄ±rÄ±r. Sesli asistanÄ± baÅŸlatmak iÃ§in aÅŸaÄŸÄ±daki butona tÄ±klayabilirsiniz.</p>
        </div>

        <header class="mb-10">
            <div class="flex flex-wrap justify-center gap-4 mt-10">
                <div class="accessibility-controls flex flex-wrap items-center gap-4 elegant-card p-4 rounded-xl elegant-shadow">
                    <span class="text-gray-700 font-medium">YazÄ± Boyutu:</span>
                    <button id="decreaseText" class="btn-outline btn-gray font-medium py-2 px-4 rounded-full transition">A-</button>
                    <button id="resetText" class="btn-outline btn-gray font-medium py-2 px-4 rounded-full transition">A</button>
                    <button id="increaseText" class="btn-outline btn-gray font-medium py-2 px-4 rounded-full transition">A+</button>
                    
                    <span class="text-gray-700 font-medium ml-4">Mod:</span>
                    <button id="toggleContrast" class="btn-outline btn-red font-medium py-2 px-4 rounded-full transition">
                        YÃ¼ksek Kontrast
                    </button>
                    
                    <button id="toggleScreenReader" class="btn-outline btn-purple font-medium py-2 px-4 rounded-full transition">
                        Ekran Okuyucu Modu
                    </button>
                </div>
            </div>
        </header>
    
        <main>
            <section class="mb-10">
                <h2 class="text-3xl font-bold text-indigo-900 mb-10 text-center">EriÅŸilebilirlik Ã–zellikleri</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="audio-guide">
                        <div class="p-8 flex flex-col items-center text-center">
                            <h3 class="text-2xl font-semibold mb-3">Sesli Rehber</h3>
                            <p class="text-gray-700">Sergi hakkÄ±nda detaylÄ± sesli aÃ§Ä±klamalar ve yÃ¶nlendirmeler</p>
                            <span class="screen-reader-text">Sesli rehber Ã¶zelliÄŸini aÃ§mak iÃ§in tÄ±klayÄ±n</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="accessible-map">
                        <div class="p-8 flex flex-col items-center text-center">
                            <h3 class="text-2xl font-semibold mb-3">EriÅŸilebilir Harita</h3>
                            <p class="text-gray-700">Engelsiz rotalarÄ± ve tesisleri gÃ¶steren interaktif harita</p>
                            <span class="screen-reader-text">EriÅŸilebilir haritayÄ± gÃ¶rÃ¼ntÃ¼lemek iÃ§in tÄ±klayÄ±n</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="artwork-info">
                        <div class="p-8 flex flex-col items-center text-center">
                            <h3 class="text-2xl font-semibold mb-3">Eser Bilgileri</h3>
                            <p class="text-gray-700">DetaylÄ± ve eriÅŸilebilir eser aÃ§Ä±klamalarÄ± ve bilgileri</p>
                            <span class="screen-reader-text">Eser bilgilerini gÃ¶rÃ¼ntÃ¼lemek iÃ§in tÄ±klayÄ±n</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="emotion-analysis">
                        <div class="p-8 flex flex-col items-center text-center">
                            <h3 class="text-2xl font-semibold mb-3">Duygu Analizi</h3>
                            <p class="text-gray-700">Eserlerin duygusal tonunu ve yarattÄ±ÄŸÄ± hissi keÅŸfedin.</p>
                            <span class="screen-reader-text">Duygu analizi Ã¶zelliÄŸini aÃ§mak iÃ§in tÄ±klayÄ±n</span>
                        </div>
                    </div>

                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="qr-scanner">
                        <div class="p-8 flex flex-col items-center text-center">
                            <h3 class="text-2xl font-semibold mb-3">QR Kodu Tara</h3>
                            <p class="text-gray-700">Eser bilgilerine hÄ±zlÄ±ca eriÅŸmek iÃ§in QR kodlarÄ±nÄ± tarayÄ±n.</p>
                            <span class="screen-reader-text">QR kod tarayÄ±cÄ±yÄ± aÃ§mak iÃ§in tÄ±klayÄ±n</span>
                        </div>
                    </div>
                    
                    <div class="feature-card elegant-card rounded-2xl elegant-shadow overflow-hidden cursor-pointer h-full" data-feature="help-support">
                        <div class="p-8 flex flex-col items-center text-center">
                            <h3 class="text-2xl font-semibold mb-3">YardÄ±m ve Destek</h3>
                            <p class="text-gray-700">Acil yardÄ±m Ã§aÄŸÄ±rma ve geri bildirim seÃ§enekleri</p>
                            <span class="screen-reader-text">YardÄ±m ve destek seÃ§eneklerini gÃ¶rÃ¼ntÃ¼lemek iÃ§in tÄ±klayÄ±n</span>
                        </div>
                    </div>
                </div>
            </section>

            <div class="flex justify-center border-b border-gray-200 mb-8">
                <button class="tab-button active" data-tab="visual-analysis">GÃ¶rsel Analiz & Bilgi</button>
                <button class="tab-button" data-tab="current-exhibitions">GÃ¼ncel Sergiler</button>
            </div>

            <section id="visual-analysis" class="tab-content active mb-20">
                <h2 class="text-3xl font-bold text-indigo-900 mb-10 text-center">GÃ¶rsel Analiz ve Bilgi âœ¨</h2>
                <div class="elegant-card rounded-2xl elegant-shadow p-8">
                    <p class="text-gray-700 mb-6">Bir gÃ¶rsel yÃ¼kleyerek veya QR kodu tarayarak yapay zeka destekli analiz ve bilgilere ulaÅŸÄ±n.</p>

                    <div class="mb-6">
                        <label for="imageUpload" class="file-input-label">
                            <span>GÃ¶rsel SeÃ§in veya SÃ¼rÃ¼kleyin</span>
                        </label>
                        <input type="file" id="imageUpload" accept="image/*" class="hidden">
                    </div>

                    <div id="imagePreviewContainer" class="mb-6 hidden">
                        <img id="imagePreview" src="#" alt="GÃ¶rsel Ã–nizlemesi" class="max-w-full h-auto rounded-lg mx-auto shadow-md">
                    </div>

                    <div class="mb-6">
                        <label for="descriptionLevel" class="block text-gray-700 text-sm font-medium mb-2 text-left">Betimleme Seviyesi:</label>
                        <select id="descriptionLevel" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="simple">Basit (Ana Ã¶ÄŸeler ve genel atmosfer)</option>
                            <option value="complex">KapsamlÄ± (DetaylÄ± sanatsal ve duygusal analiz)</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <button id="describeImageButton" class="btn-outline btn-red font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center gap-2" disabled>
                            <span id="buttonText">GÃ¶rseli Betimle</span>
                            <div id="loadingSpinner" class="loading-spinner hidden"></div>
                        </button>
                        <button id="analyzeEmotionButton" class="btn-outline btn-pink font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center gap-2" disabled>
                            <span>Duygu Analizi</span>
                            <div class="loading-spinner hidden"></div>
                        </button>
                        <button id="getArtworkInfoButton" class="btn-outline btn-purple font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center gap-2" disabled>
                            <span>SanatÃ§Ä± ve Eser Bilgisi</span>
                            <div class="loading-spinner hidden"></div>
                        </button>
                        <button id="openAskQuestionModalButton" class="btn-outline btn-green font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center gap-2" disabled>
                            <span>GÃ¶rsel HakkÄ±nda Soru Sor</span>
                            <div class="loading-spinner hidden"></div>
                        </button>
                    </div>

                    <div id="errorMessage" class="bg-red-50 p-4 rounded-lg text-red-500 mb-4 hidden" role="alert"></div>

                    <div id="descriptionOutput" class="mt-6 p-4 rounded-lg text-left border border-blue-400 bg-blue-900/20 hidden" role="region">
                        <h4 id="descriptionTitle" class="font-medium text-blue-300 mb-2">GÃ¶rsel Betimlemesi:</h4>
                        <p id="descriptionText" class="whitespace-pre-wrap text-gray-700"></p>
                        <button id="copyDescriptionButton" class="copy-button mt-3">Panoya Kopyala</button>
                        <button id="showSignLanguageButton" class="btn-outline btn-blue font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105 mt-3 ml-2">
                            TÃ¼rkÃ§e Ä°ÅŸaret Dili (TÄ°D)
                        </button>
                        <div id="signLanguageVideoContainer" class="sign-language-video-placeholder hidden">
                            <p>TÃ¼rkÃ§e Ä°ÅŸaret Dili (TÄ°D) videosu burada yer alacaktÄ±r.</p>
                            <p class="text-sm italic mt-2">(GerÃ§ek bir entegrasyon iÃ§in TÄ°D video API'si veya Ã¶nceden hazÄ±rlanmÄ±ÅŸ videolar gereklidir.)</p>
                        </div>
                    </div>

                    <div id="emotionalOutput" class="mt-6 p-4 rounded-lg text-left border border-pink-400 bg-pink-900/20 hidden" role="region">
                        <h4 id="emotionalTitle" class="font-medium text-pink-300 mb-2">Duygu Analizi Sonucu:</h4>
                        <p id="emotionalText" class="whitespace-pre-wrap text-gray-700"></p>
                        <button id="copyEmotionalButton" class="copy-button mt-3">Panoya Kopyala</button>
                    </div>

                    <div id="artworkInfoOutput" class="mt-6 p-4 rounded-lg text-left border border-purple-400 bg-purple-900/20 hidden" role="region">
                        <h4 id="artworkInfoTitle" class="font-medium text-purple-300 mb-2">SanatÃ§Ä± ve Eser Bilgisi:</h4>
                        <p id="artworkInfoText" class="whitespace-pre-wrap text-gray-700"></p>
                        <button id="copyArtworkInfoButton" class="copy-button mt-3">Panoya Kopyala</button>
                    </div>
                </div>
            </section>

            <section id="current-exhibitions" class="tab-content mb-20">
                <h2 class="text-3xl font-bold text-indigo-900 mb-10 text-center">GÃ¼ncel Sergiler</h2>
                <div class="elegant-card rounded-2xl elegant-shadow p-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="elegant-border rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h3 class="text-xl font-semibold text-indigo-900 mb-3">Modern Sanat Sergisi</h3>
                            <p class="text-gray-700 mb-4">A Salonu - 1. Kat</p>
                            <span class="inline-block bg-green-50 text-green-700 text-xs px-3 py-1.5 rounded-full font-medium">Tamamen EriÅŸilebilir</span>
                        </div>
                        <div class="elegant-border rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h3 class="text-xl font-semibold text-indigo-900 mb-3">Tarihi Eserler</h3>
                            <p class="text-gray-700 mb-4">B Salonu - 2. Kat</p>
                            <span class="inline-block bg-amber-50 text-amber-700 text-xs px-3 py-1.5 rounded-full font-medium">KÄ±smen EriÅŸilebilir</span>
                        </div>
                        <div class="elegant-border rounded-xl p-6 hover:shadow-md transition-shadow">
                            <h3 class="text-xl font-semibold text-indigo-900 mb-3">Dijital Sanat</h3>
                            <p class="text-gray-700 mb-4">C Salonu - GiriÅŸ Kat</p>
                            <span class="inline-block bg-green-50 text-green-700 text-xs px-3 py-1.5 rounded-full font-medium">Tamamen EriÅŸilebilir</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center text-gray-600 mt-20 pb-8">
            <div class="w-24 h-1 bg-indigo-200 mx-auto mb-6 rounded-full"></div>
            <p>Â© 2025 Sergi EriÅŸilebilirlik UygulamasÄ± | TÃ¼m HaklarÄ± SaklÄ±dÄ±r</p>
            <p class="mt-4 text-gray-700">Bu prototip GÃ¶rsel Ä°letiÅŸim TasarÄ±mÄ± ve Dijital DÃ¶nÃ¼ÅŸÃ¼m UzmanÄ± Semanur AyyÄ±ldÄ±z tarafÄ±ndan oluÅŸturulmuÅŸtur.</p>
            <div class="flex justify-center items-center gap-4 mt-3">
                <a href="tel:+905079448462" class="btn-outline btn-red font-medium py-2 px-4 rounded-full transition">Telefon Et</a>
                <a href="https://www.linkedin.com/in/semayy/" target="_blank" rel="noopener noreferrer" class="btn-outline btn-blue font-medium py-2 px-4 rounded-full transition">LinkedIn</a>
            </div>
        </footer>
    </div>

    <div id="voice-assistant-button" class="voice-assistant-button">
        KonuÅŸ
    </div>

    <div id="voice-assistant-panel" class="voice-assistant-panel hidden">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-indigo-900">Sesli Asistan</h3>
            <button id="close-assistant" class="text-gray-500 hover:text-gray-700">
                &times;
            </button>
        </div>
        
        <div id="voice-assistant-messages" class="voice-assistant-messages">
            <div class="voice-message assistant-message">
                <p>Merhaba! Ben sergi asistanÄ±nÄ±z. Size nasÄ±l yardÄ±mcÄ± olabilirim?</p>
            </div>
        </div>
        
        <div class="flex items-center gap-3 mt-4">
            <button id="start-voice" class="btn-outline btn-red font-medium py-2 px-4 rounded-full transition flex-grow flex items-center justify-center gap-2">
                KonuÅŸmaya BaÅŸla
            </button>
            
            <button id="type-message" class="btn-outline btn-gray font-medium p-2 rounded-full transition">
                Yaz
            </button>
        </div>
        
        <div id="text-input-area" class="mt-3 hidden">
            <div class="flex gap-2">
                <input type="text" id="text-message" class="flex-grow px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n...">
                <button id="send-text" class="btn-outline btn-red font-medium p-2 rounded-full transition">
                    GÃ¶nder
                </button>
            </div>
        </div>
        <div id="listening-animation" class="listening-animation mt-2 hidden">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>

    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="modal-content bg-white rounded-2xl elegant-shadow max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modal-title" class="text-3xl font-bold text-indigo-900"></h2>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700 transition">
                        &times;
                    </button>
                </div>
                <div id="modal-content"></div>
            </div>
        </div>
    </div>

    <div id="askQuestionModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="askQuestionTitle">
        <div class="modal-content">
            <span class="close-button" id="closeAskQuestionModalButton" aria-label="Soru sorma ekranÄ±nÄ± kapat">&times;</span>
            <h3 id="askQuestionTitle" class="text-xl font-bold mb-4">GÃ¶rsel HakkÄ±nda Soru Sor</h3>
            <p class="mb-4 text-gray-700">YÃ¼klediÄŸiniz gÃ¶rselle ilgili bir soru sorun, yapay zeka cevaplasÄ±n.</p>
            <textarea id="questionInput" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-green-500" rows="3" placeholder="Sorunuzu buraya yazÄ±n..."></textarea>
            <button id="answerQuestionButton" class="btn-outline btn-green font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 mt-4 w-full flex items-center justify-center gap-2" disabled>
                <span id="answerQuestionButtonText">Cevapla</span>
                <div id="answerQuestionSpinner" class="loading-spinner hidden"></div>
            </button>
            <p id="questionErrorMessage" class="text-red-500 text-sm mt-2 hidden" role="alert"></p>

            <div id="questionOutput" class="mt-6 p-4 rounded-lg text-left border border-green-400 bg-green-900/20 hidden" role="region">
                <h4 id="answerTitle" class="font-medium text-green-300 mb-2">Cevap:</h4>
                <p id="answerText" class="whitespace-pre-wrap text-gray-700"></p>
                <button id="copyAnswerButton" class="copy-button mt-3">Panoya Kopyala</button>
            </div>
        </div>
    </div>

    <div id="qrScannerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="qrScannerTitle">
        <div class="modal-content">
            <span class="close-button" id="closeQrScannerModalButton" aria-label="QR tarayÄ±cÄ±yÄ± kapat">&times;</span>
            <h3 id="qrScannerTitle" class="text-xl font-bold mb-4">QR Kodu Tara</h3>
            <p class="mb-4 text-gray-700">LÃ¼tfen kameranÄ±zÄ± QR koduna doÄŸru tutun.</p>
            <video id="video" playsinline></video>
            <canvas id="canvas" class="hidden"></canvas>
            <p id="qrStatus" class="text-gray-700 mt-2" aria-live="polite">Kamera bekleniyor...</p>
            <p id="qrErrorMessage" class="text-red-500 text-sm mt-2 hidden" role="alert" aria-live="assertive"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Font size adjustment
            const htmlElement = document.documentElement;
            let currentFontSize = 100; // percentage
            
            const increaseTextButton = document.getElementById('increaseText');
            const decreaseTextButton = document.getElementById('decreaseText');
            const resetTextButton = document.getElementById('resetText');

            if (increaseTextButton) {
                increaseTextButton.addEventListener('click', function() {
                    if (currentFontSize < 150) {
                        currentFontSize += 10;
                        htmlElement.style.fontSize = currentFontSize + '%';
                    }
                });
            }
            
            if (decreaseTextButton) {
                decreaseTextButton.addEventListener('click', function() {
                    if (currentFontSize > 70) {
                        currentFontSize -= 10;
                        htmlElement.style.fontSize = currentFontSize + '%';
                    }
                });
            }
            
            if (resetTextButton) {
                resetTextButton.addEventListener('click', function() {
                    currentFontSize = 100;
                    htmlElement.style.fontSize = '100%';
                });
            }
            
            // High contrast mode
            const toggleContrastButton = document.getElementById('toggleContrast');
            if (toggleContrastButton) {
                toggleContrastButton.addEventListener('click', function() {
                    document.body.classList.toggle('high-contrast');
                });
            }
            
            // Screen reader mode
            const toggleScreenReaderButton = document.getElementById('toggleScreenReader');
            if (toggleScreenReaderButton) {
                toggleScreenReaderButton.addEventListener('click', function() {
                    document.body.classList.toggle('screen-reader-mode');
                });
            }
            
            // Modal functionality
            const modalContainer = document.getElementById('modal-container');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const closeModal = document.getElementById('close-modal');
            
            function openModal(title, content) {
                if (modalTitle) modalTitle.textContent = title;
                if (modalContent) modalContent.innerHTML = content;
                if (modalContainer) {
                    modalContainer.classList.remove('hidden');
                    modalContainer.classList.add('flex');
                }
            }
            
            if (closeModal) {
                closeModal.addEventListener('click', function() {
                    if (modalContainer) {
                        modalContainer.classList.add('hidden');
                        modalContainer.classList.remove('flex');
                    }
                });
            }
            
            // Close modal when clicking outside
            if (modalContainer) {
                modalContainer.addEventListener('click', function(e) {
                    if (e.target === modalContainer) {
                        modalContainer.classList.add('hidden');
                        modalContainer.classList.remove('flex');
                    }
                });
            }
            
            // Feature cards
            const featureCards = document.querySelectorAll('.feature-card');
            
            featureCards.forEach(card => {
                if (card) { // Ensure card exists
                    card.addEventListener('click', function() {
                        const feature = this.getAttribute('data-feature');
                        let title, content;
                        
                        switch(feature) {
                            case 'audio-guide':
                                title = 'Sesli Rehber';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-700">Sergi deneyiminizi zenginleÅŸtirmek iÃ§in sesli rehberimizi kullanabilirsiniz. AÅŸaÄŸÄ±daki sergilerden birini seÃ§erek sesli anlatÄ±mÄ± baÅŸlatÄ±n.</p>
                                        
                                        <div class="bg-gray-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Mevcut Sesli Rehberler</h3>
                                            <ul class="space-y-4">
                                                <li>
                                                    <button class="flex items-center w-full text-left p-4 btn-outline btn-red rounded-xl hover:bg-gray-100 transition">
                                                        <div>
                                                            <div class="font-medium text-lg text-indigo-900">Modern Sanat Sergisi</div>
                                                            <div class="text-sm text-gray-700 mt-1">SÃ¼re: 25 dakika</div>
                                                        </div>
                                                    </button>
                                                </li>
                                                <li>
                                                    <button class="flex items-center w-full text-left p-4 btn-outline btn-red rounded-xl hover:bg-gray-100 transition">
                                                        <div>
                                                            <div class="font-medium text-lg text-indigo-900">Tarihi Eserler</div>
                                                            <div class="text-sm text-gray-700 mt-1">SÃ¼re: 40 dakika</div>
                                                        </div>
                                                    </button>
                                                </li>
                                                <li>
                                                    <button class="flex items-center w-full text-left p-4 btn-outline btn-red rounded-xl hover:bg-gray-100 transition">
                                                        <div>
                                                            <div class="font-medium text-lg text-indigo-900">Dijital Sanat</div>
                                                            <div class="text-sm text-gray-700 mt-1">SÃ¼re: 20 dakika</div>
                                                        </div>
                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                        
                                        <div class="bg-red-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Ã–zellikler</h3>
                                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                <li class="flex items-center">
                                                    DetaylÄ± eser aÃ§Ä±klamalarÄ±
                                                </li>
                                                <li class="flex items-center">
                                                    SanatÃ§Ä± biyografileri
                                                </li>
                                                <li class="flex items-center">
                                                    Tarihsel baÄŸlam bilgileri
                                                </li>
                                                <li class="flex items-center">
                                                    Ã‡oklu dil desteÄŸi
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'accessible-map':
                                title = 'EriÅŸilebilir Harita';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-700">Sergi alanÄ±nda kolayca yÃ¶n bulmanÄ±zÄ± saÄŸlayan eriÅŸilebilir haritamÄ±z, engelsiz rotalarÄ±, asansÃ¶rleri, rampalarÄ± ve diÄŸer eriÅŸilebilirlik Ã¶zelliklerini gÃ¶sterir.</p>
                                        
                                        <div class="elegant-border rounded-xl p-6 relative">
                                            <svg viewBox="0 0 500 300" class="w-full h-auto">
                                                <rect x="50" y="50" width="400" height="200" fill="#fef2f2" stroke="#ef4444" stroke-width="2"/>
                                                
                                                <rect x="70" y="70" width="100" height="80" fill="#fee2e2" stroke="#fca5a5" stroke-width="1.5"/>
                                                <text x="120" y="110" text-anchor="middle" font-size="12" fill="#333333" font-family="Inter">A Salonu</text>
                                                
                                                <rect x="190" y="70" width="100" height="80" fill="#fee2e2" stroke="#fca5a5" stroke-width="1.5"/>
                                                <text x="240" y="110" text-anchor="middle" font-size="12" fill="#333333" font-family="Inter">B Salonu</text>
                                                
                                                <rect x="310" y="70" width="120" height="80" fill="#fee2e2" stroke="#fca5a5" stroke-width="1.5"/>
                                                <text x="370" y="110" text-anchor="middle" font-size="12" fill="#333333" font-family="Inter">C Salonu</text>
                                                
                                                <rect x="70" y="170" width="160" height="60" fill="#fee2e2" stroke="#fca5a5" stroke-width="1.5"/>
                                                <text x="150" y="200" text-anchor="middle" font-size="12" fill="#333333" font-family="Inter">GiriÅŸ Salonu</text>
                                                
                                                <path d="M150 230 L150 260 L370 260 L370 150" stroke="#22c55e" stroke-width="2.5" stroke-dasharray="5,5" fill="none"/>
                                                
                                                <circle cx="150" cy="240" r="8" fill="#22c55e"/>
                                                <text x="150" y="265" text-anchor="middle" font-size="10" fill="#333333" font-family="Inter">GiriÅŸ</text>
                                                
                                                <circle cx="240" cy="90" r="8" fill="#dc2626"/>
                                                <text x="240" y="90" text-anchor="middle" font-size="10" fill="white" font-family="Inter">i</text>
                                                
                                                <circle cx="370" cy="90" r="8" fill="#dc2626"/>
                                                <text x="370" y="90" text-anchor="middle" font-size="10" fill="white" font-family="Inter">i</text>
                                                
                                                <circle cx="100" cy="200" r="8" fill="#f43f5e"/>
                                                <text x="100" y="203" text-anchor="middle" font-size="10" fill="white">â™¿</text>
                                                
                                                <circle cx="200" cy="200" r="8" fill="#f43f5e"/>
                                                <text x="200" y="203" text-anchor="middle" font-size="10" fill="white">ðŸš»</text>
                                                
                                                <circle cx="330" cy="120" r="8" fill="#f43f5e"/>
                                                <text x="330" y="123" text-anchor="middle" font-size="10" fill="white">ðŸš»</text>
                                            </svg>
                                            
                                            <div class="mt-6">
                                                <h3 class="font-medium text-xl mb-4 text-indigo-900">Sembol AÃ§Ä±klamalarÄ±</h3>
                                                <div class="grid grid-cols-2 gap-4">
                                                    <div class="flex items-center">
                                                        <div class="w-5 h-5 bg-emerald-500 rounded-full mr-3"></div>
                                                        <span class="text-gray-700">EriÅŸilebilir GiriÅŸ</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="w-5 h-5 bg-red-600 rounded-full mr-3"></div>
                                                        <span class="text-gray-700">Bilgi NoktasÄ±</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="w-5 h-5 bg-pink-600 rounded-full mr-3"></div>
                                                        <span class="text-gray-700">EriÅŸilebilir Tuvalet</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-0 border-t-2 border-dashed border-emerald-500 mr-3"></div>
                                                        <span class="text-gray-700">EriÅŸilebilir Rota</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-red-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">EriÅŸilebilirlik Bilgileri</h3>
                                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <li class="flex items-center">
                                                    TÃ¼m katlara asansÃ¶r eriÅŸimi
                                                </li>
                                                <li class="flex items-center">
                                                    EriÅŸilebilir tuvaletler
                                                </li>
                                                <li class="flex items-center">
                                                    Tekerlekli sandalye Ã¶dÃ¼nÃ§ alma
                                                </li>
                                                <li class="flex items-center">
                                                    Engelsiz park alanlarÄ±
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'artwork-info':
                                title = 'Eser Bilgileri';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-700">Sergimizdeki eserler hakkÄ±nda detaylÄ± bilgilere buradan eriÅŸebilirsiniz. Her eser iÃ§in aÃ§Ä±klamalar, sanatÃ§Ä± bilgileri ve baÄŸlamsal bilgiler sunulmaktadÄ±r.</p>
                                        
                                        <div class="bg-gray-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Ã–ne Ã‡Ä±kan Eserler</h3>
                                            
                                            <div class="space-y-5">
                                                <div class="elegant-border rounded-xl p-5 hover:shadow-md transition-shadow">
                                                    <h4 class="font-medium text-lg text-indigo-900">Mavi Kompozisyon</h4>
                                                    <p class="text-sm text-gray-700 mt-1">Ahmet YÄ±lmaz, 2018</p>
                                                    <p class="mt-3 text-gray-700">Bu eser, sanatÃ§Ä±nÄ±n mavi tonlarÄ±nÄ± kullanarak yarattÄ±ÄŸÄ± soyut bir Ã§alÄ±ÅŸmadÄ±r. Eser, deniz ve gÃ¶kyÃ¼zÃ¼ arasÄ±ndaki iliÅŸkiyi yansÄ±tmaktadÄ±r.</p>
                                                    <button class="mt-4 text-red-600 hover:text-red-800 text-sm font-medium flex items-center">
                                                        DetaylÄ± bilgi
                                                    </button>
                                                </div>
                                                
                                                <div class="elegant-border rounded-xl p-5 hover:shadow-md transition-shadow">
                                                    <h4 class="font-medium text-lg text-indigo-900">Zaman ve Mekan</h4>
                                                    <p class="text-sm text-gray-700 mt-1">Zeynep Kaya, 2020</p>
                                                    <p class="mt-3 text-gray-700">Bu heykel Ã§alÄ±ÅŸmasÄ±, zamanÄ±n ve mekanÄ±n akÄ±ÅŸkanlÄ±ÄŸÄ±nÄ± temsil etmektedir. SanatÃ§Ä±, bronz ve cam malzemeleri kullanarak bu kavramlarÄ± somutlaÅŸtÄ±rmÄ±ÅŸtÄ±r.</p>
                                                    <button class="mt-4 text-red-600 hover:text-red-800 text-sm font-medium flex items-center">
                                                        DetaylÄ± bilgi
                                                    </button>
                                                </div>
                                                
                                                <div class="elegant-border rounded-xl p-5 hover:shadow-md transition-shadow">
                                                    <h4 class="font-medium text-lg text-indigo-900">Dijital Ã‡aÄŸ</h4>
                                                    <p class="text-sm text-gray-700 mt-1">Mehmet Demir, 2022</p>
                                                    <p class="mt-3 text-gray-700">Bu dijital enstalasyon, teknolojinin insan yaÅŸamÄ±na etkisini interaktif bir ÅŸekilde ele almaktadÄ±r. ZiyaretÃ§iler, eserin bir parÃ§asÄ± haline gelerek deneyimi tamamlamaktadÄ±r.</p>
                                                    <button class="mt-4 text-red-600 hover:text-red-800 text-sm font-medium flex items-center">
                                                        DetaylÄ± bilgi
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-red-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">EriÅŸilebilirlik Ã–zellikleri</h3>
                                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <li class="flex items-center">
                                                    Braille alfabesi ile yazÄ±lmÄ±ÅŸ aÃ§Ä±klamalar
                                                </li>
                                                <li class="flex items-center">
                                                    Sesli aÃ§Ä±klamalar
                                                </li>
                                                <li class="flex items-center">
                                                    Dokunsal reprodÃ¼ksiyonlar
                                                </li>
                                                <li class="flex items-center">
                                                    Ä°ÅŸaret dili videolarÄ±
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'emotion-analysis': // New case for Emotion Analysis
                                title = 'Duygu Analizi';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-700">Bu Ã¶zellik, yÃ¼klediÄŸiniz gÃ¶rselin duygusal tonunu ve izleyicide uyandÄ±rabileceÄŸi hisleri yapay zeka aracÄ±lÄ±ÄŸÄ±yla analiz eder.</p>
                                        <div class="elegant-border rounded-xl p-6">
                                            <p class="text-gray-700">LÃ¼tfen bir gÃ¶rsel yÃ¼kleyin veya QR kodu tarayarak bir eser seÃ§in. Duygu analizi otomatik olarak yapÄ±lacaktÄ±r.</p>
                                            <div id="modalEmotionOutput" class="mt-4 p-4 rounded-lg text-left hidden" role="region">
                                                <p class="font-medium text-pink-300 mb-2">Analiz Sonucu:</p>
                                                <p id="modalEmotionText" class="whitespace-pre-wrap text-gray-700"></p>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'qr-scanner': // New case for QR Scanner
                                title = 'QR Kodu Tara';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-700">Sergideki eserlerin QR kodlarÄ±nÄ± tarayarak anÄ±nda bilgilere ulaÅŸÄ±n.</p>
                                        <div class="elegant-border rounded-xl p-6">
                                            <p class="text-gray-700">QR tarayÄ±cÄ±yÄ± baÅŸlatmak iÃ§in aÅŸaÄŸÄ±daki butona tÄ±klayÄ±n.</p>
                                            <button id="startModalQrScannerButton" class="btn-outline btn-yellow font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 transform hover:scale-105 mt-4 w-full">
                                                QR TarayÄ±cÄ±yÄ± BaÅŸlat
                                            </button>
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'help-support':
                                title = 'YardÄ±m ve Destek';
                                content = `
                                    <div class="space-y-6">
                                        <p class="text-gray-700">Sergi ziyaretiniz sÄ±rasÄ±nda herhangi bir yardÄ±ma ihtiyacÄ±nÄ±z olursa, aÅŸaÄŸÄ±daki seÃ§enekleri kullanabilirsiniz.</p>
                                        
                                        <div class="bg-red-50 p-6 rounded-xl border border-red-100">
                                            <h3 class="font-medium text-xl text-red-800 mb-3">Acil YardÄ±m</h3>
                                            <p class="mb-4 text-gray-700">Acil bir durumda hemen personelimize ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki dÃ¼ÄŸmeyi kullanabilirsiniz.</p>
                                            <button class="btn-outline btn-red font-medium py-3 px-6 rounded-xl flex items-center justify-center w-full transition shadow-sm hover:shadow">
                                                Acil YardÄ±m Ã‡aÄŸÄ±r
                                            </button>
                                        </div>
                                        
                                        <div class="bg-gray-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Ä°letiÅŸim SeÃ§enekleri</h3>
                                            
                                            <div class="space-y-4">
                                                <div class="flex items-center p-4 elegant-border rounded-xl hover:bg-gray-100 transition">
                                                    <div>
                                                        <div class="font-medium text-lg text-indigo-900">Telefon</div>
                                                        <div class="text-gray-700 mt-1">0212 123 45 67</div>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-center p-4 elegant-border rounded-xl hover:bg-gray-100 transition">
                                                    <div>
                                                        <div class="font-medium text-lg text-indigo-900">E-posta</div>
                                                        <div class="text-gray-700 mt-1">destek@sergi.com</div>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-center p-4 elegant-border rounded-xl hover:bg-gray-100 transition">
                                                    <div>
                                                        <div class="font-medium text-lg text-indigo-900">CanlÄ± Sohbet</div>
                                                        <div class="text-gray-700 mt-1">Hemen baÅŸlat</div>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-red-50 p-6 rounded-xl">
                                            <h3 class="font-medium text-xl mb-4 text-indigo-900">Geri Bildirim</h3>
                                            <p class="mb-4 text-gray-700">Deneyiminizi iyileÅŸtirmemize yardÄ±mcÄ± olmak iÃ§in geri bildirimde bulunabilirsiniz.</p>
                                            
                                            <div class="space-y-4">
                                                <div>
                                                    <label for="feedback-name" class="block text-sm font-medium text-gray-700 mb-2">AdÄ±nÄ±z</label>
                                                    <input type="text" id="feedback-name" class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                                                </div>
                                                
                                                <div>
                                                    <label for="feedback-message" class="block text-sm font-medium text-gray-700 mb-2">MesajÄ±nÄ±z</label>
                                                    <textarea id="feedback-message" rows="3" class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                                                </div>
                                                
                                                <button class="btn-outline btn-red font-medium py-3 px-6 rounded-xl w-full transition shadow-sm hover:shadow">GÃ¶nder</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                break;
                        }
                        
                        openModal(title, content);

                        // If the opened modal is for QR Scanner, attach event listener
                        if (feature === 'qr-scanner') {
                            const startModalQrScannerButton = document.getElementById('startModalQrScannerButton');
                            if (startModalQrScannerButton) {
                                startModalQrScannerButton.addEventListener('click', () => {
                                    // Close the main modal first
                                    if (modalContainer) {
                                        modalContainer.classList.add('hidden');
                                        modalContainer.classList.remove('flex');
                                    }
                                    // Then open the QR scanner modal
                                    if (openQrScannerButton) {
                                        openQrScannerButton.click();
                                    }
                                });
                            }
                        }
                    });
                }
            });
            
            // Voice Assistant Functionality
            const voiceAssistantButton = document.getElementById('voice-assistant-button');
            const voiceAssistantPanel = document.getElementById('voice-assistant-panel');
            const closeAssistant = document.getElementById('close-assistant');
            const startVoiceButton = document.getElementById('start-voice');
            const typeMessageButton = document.getElementById('type-message');
            const textInputArea = document.getElementById('text-input-area');
            const textMessage = document.getElementById('text-message');
            const sendTextButton = document.getElementById('send-text');
            const voiceAssistantMessages = document.getElementById('voice-assistant-messages');
            const listeningAnimation = document.getElementById('listening-animation');
            
            // Toggle voice assistant panel
            if (voiceAssistantButton) {
                voiceAssistantButton.addEventListener('click', function() {
                    if (voiceAssistantPanel) {
                        voiceAssistantPanel.classList.toggle('active'); // Use 'active' class for animation
                        if (voiceAssistantPanel.classList.contains('active')) {
                            voiceAssistantButton.classList.add('pulse-animation');
                            // Scroll to bottom when panel opens
                            voiceAssistantMessages.scrollTop = voiceAssistantMessages.scrollHeight;
                        } else {
                            voiceAssistantButton.classList.remove('pulse-animation');
                            // Hide text input and animation when panel closes
                            if (textInputArea) textInputArea.classList.add('hidden');
                            if (listeningAnimation) listeningAnimation.classList.add('hidden');
                        }
                    }
                });
            }
            
            if (closeAssistant) {
                closeAssistant.addEventListener('click', function() {
                    if (voiceAssistantPanel) {
                        voiceAssistantPanel.classList.remove('active'); // Remove 'active' class
                        if (voiceAssistantButton) voiceAssistantButton.classList.remove('pulse-animation');
                        // Hide text input and animation when panel closes
                        if (textInputArea) textInputArea.classList.add('hidden');
                        if (listeningAnimation) listeningAnimation.classList.add('hidden');
                    }
                });
            }
            
            // Toggle text input area
            if (typeMessageButton) {
                typeMessageButton.addEventListener('click', function() {
                    if (textInputArea) {
                        textInputArea.classList.toggle('hidden');
                        if (!textInputArea.classList.contains('hidden') && textMessage) {
                            textMessage.focus();
                        }
                    }
                });
            }
            
            // Send text message
            function sendMessage(message) {
                // Add user message to chat
                if (voiceAssistantMessages) {
                    const userMessageElement = document.createElement('div');
                    userMessageElement.className = 'voice-message user-message';
                    userMessageElement.innerHTML = `<p>${message}</p>`;
                    voiceAssistantMessages.appendChild(userMessageElement);
                    
                    // Scroll to bottom of messages
                    voiceAssistantMessages.scrollTop = voiceAssistantMessages.scrollHeight;
                }
                
                // Process the message and respond (simulated)
                setTimeout(() => {
                    respondToMessage(message);
                }, 1000);
            }
            
            if (sendTextButton) {
                sendTextButton.addEventListener('click', function() {
                    if (textMessage) {
                        const message = textMessage.value.trim();
                        if (message) {
                            sendMessage(message);
                            textMessage.value = '';
                        }
                    }
                });
            }
            
            if (textMessage) {
                textMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const message = textMessage.value.trim();
                        if (message) {
                            sendMessage(message);
                            textMessage.value = '';
                        }
                    }
                });
            }
            
            // Voice recognition simulation
            if (startVoiceButton) {
                startVoiceButton.addEventListener('click', function() {
                    if (listeningAnimation) {
                        listeningAnimation.classList.remove('hidden');
                    }
                    if (startVoiceButton) {
                        startVoiceButton.textContent = 'Dinleniyor...';
                        startVoiceButton.disabled = true;
                    }
                    
                    // Simulate voice recognition (in a real app, this would use the Web Speech API)
                    setTimeout(() => {
                        const simulatedVoiceCommands = [
                            "Modern Sanat Sergisi nerede?",
                            "En yakÄ±n tuvalet nerede?",
                            "Dijital Sanat sergisi hakkÄ±nda bilgi verir misin?",
                            "Tekerlekli sandalye nereden alabilirim?",
                            "Duygu analizi yap", // New command
                            "SanatÃ§Ä± bilgisi ver", // New command
                            "Merhaba, nasÄ±lsÄ±n?", // General LLM command
                            "Sergi saatleri kaÃ§la kaÃ§ arasÄ±nda?" // General LLM command
                        ];
                        
                        const randomCommand = simulatedVoiceCommands[Math.floor(Math.random() * simulatedVoiceCommands.length)];
                        sendMessage(randomCommand);
                        
                        if (listeningAnimation) {
                            listeningAnimation.classList.add('hidden');
                        }
                        if (startVoiceButton) {
                            startVoiceButton.textContent = 'KonuÅŸmaya BaÅŸla';
                            startVoiceButton.disabled = false;
                        }
                    }, 2000);
                });
            }
            
            // Respond to user messages
            async function respondToMessage(message) {
                let response = '';
                
                // Simple pattern matching for responses
                message = message.toLowerCase();
                
                if (message.includes('merhaba') || message.includes('selam')) {
                    response = 'Merhaba! Size nasÄ±l yardÄ±mcÄ± olabilirim?';
                } else if (message.includes('modern sanat') || message.includes('modern')) {
                    response = 'Modern Sanat Sergisi A Salonunda, 1. katta bulunmaktadÄ±r. AsansÃ¶r veya merdivenlerden ulaÅŸabilirsiniz.';
                } else if (message.includes('tarihi eser') || message.includes('tarihi')) {
                    response = 'Tarihi Eserler Sergisi B Salonunda, 2. katta bulunmaktadÄ±r. AsansÃ¶r veya merdivenlerden ulaÅŸabilirsiniz.';
                } else if (message.includes('dijital') || message.includes('dijital sanat')) {
                    response = 'Dijital Sanat Sergisi C Salonunda, giriÅŸ katta bulunmaktadÄ±r. Bu sergide interaktif dijital enstalasyonlar yer almaktadÄ±r.';
                } else if (message.includes('tuvalet') || message.includes('wc')) {
                    response = 'En yakÄ±n tuvaletler giriÅŸ katÄ±nda, GiriÅŸ Salonunun saÄŸ tarafÄ±nda bulunmaktadÄ±r. AyrÄ±ca her katta eriÅŸilebilir tuvaletler mevcuttur.';
                } else if (message.includes('tekerlekli sandalye')) {
                    response = 'Tekerlekli sandalye Ã¶dÃ¼nÃ§ almak iÃ§in giriÅŸ katÄ±ndaki bilgi masasÄ±na baÅŸvurabilirsiniz. Ãœcretsiz olarak hizmetinizdedir.';
                } else if (message.includes('yardÄ±m') || message.includes('destek')) {
                    response = 'Size nasÄ±l yardÄ±mcÄ± olabilirim? Sergi hakkÄ±nda bilgi, yÃ¶n tarifi veya eriÅŸilebilirlik Ã¶zellikleri konusunda sorularÄ±nÄ±zÄ± yanÄ±tlayabilirim.';
                } else if (message.includes('teÅŸekkÃ¼r')) {
                    response = 'Rica ederim! BaÅŸka bir sorunuz olursa yardÄ±mcÄ± olmaktan memnuniyet duyarÄ±m.';
                } else if (message.includes('duygu analizi yap')) { // New voice assistant response
                    response = 'Duygu analizi yapÄ±lÄ±yor... LÃ¼tfen bir gÃ¶rsel yÃ¼klediÄŸinizden emin olun.';
                    // Trigger the actual analysis if an image is loaded
                    if (base64ImageData && analyzeEmotionButton) {
                        analyzeEmotionButton.click();
                        response = 'GÃ¶rselin duygu analizi baÅŸlatÄ±ldÄ±.';
                    }
                } else if (message.includes('sanatÃ§Ä± bilgisi ver')) { // New voice assistant response
                    response = 'SanatÃ§Ä± ve eser bilgisi alÄ±nÄ±yor... LÃ¼tfen bir gÃ¶rsel yÃ¼klediÄŸinizden emin olun.';
                    // Trigger the actual info retrieval if an image is loaded
                    if (base64ImageData && getArtworkInfoButton) {
                        getArtworkInfoButton.click();
                        response = 'GÃ¶rselin sanatÃ§Ä± ve eser bilgisi baÅŸlatÄ±ldÄ±.';
                    }
                }
                else {
                    // Fallback to LLM for general questions
                    const thinkingMessageElement = document.createElement('div');
                    thinkingMessageElement.className = 'voice-message assistant-message';
                    thinkingMessageElement.innerHTML = `<p>DÃ¼ÅŸÃ¼nÃ¼yorum...</p>`;
                    voiceAssistantMessages.appendChild(thinkingMessageElement);
                    voiceAssistantMessages.scrollTop = voiceAssistantMessages.scrollHeight;

                    try {
                        let chatHistory = [];
                        chatHistory.push({ role: "user", parts: [{ text: message }] });
                        const payload = { contents: chatHistory };
                        const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; // API Key added here
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                        const apiResponse = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await apiResponse.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            response = result.candidates[0].content.parts[0].text;
                        } else {
                            response = 'ÃœzgÃ¼nÃ¼m, bu konuda size yardÄ±mcÄ± olamÄ±yorum. LÃ¼tfen sorunuzu daha detaylÄ± bir ÅŸekilde belirtir misiniz?';
                        }
                    } catch (error) {
                        console.error('LLM yanÄ±t hatasÄ±:', error);
                        response = 'ÃœzgÃ¼nÃ¼m, bir sorun oluÅŸtu. LÃ¼tfen daha sonra tekrar deneyin.';
                    } finally {
                        // Remove "DÃ¼ÅŸÃ¼nÃ¼yorum..." message
                        if (thinkingMessageElement.parentNode) {
                            thinkingMessageElement.parentNode.removeChild(thinkingMessageElement);
                        }
                    }
                }
                
                // Add assistant response to chat
                if (voiceAssistantMessages) {
                    const assistantMessageElement = document.createElement('div');
                    assistantMessageElement.className = 'voice-message assistant-message';
                    assistantMessageElement.innerHTML = `<p>${response}</p>`;
                    voiceAssistantMessages.appendChild(assistantMessageElement);
                    
                    // Scroll to bottom of messages
                    voiceAssistantMessages.scrollTop = voiceAssistantMessages.scrollHeight;
                }
            }

            // --- Existing Image-to-Audio-Description Logic (adapted) ---
            const imageUpload = document.getElementById('imageUpload');
            const fileNameSpan = document.getElementById('fileName');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const describeImageButton = document.getElementById('describeImageButton');
            const buttonText = describeImageButton ? describeImageButton.querySelector('#buttonText') : null; // Get nested span
            const loadingSpinner = describeImageButton ? describeImageButton.querySelector('.loading-spinner') : null; // Get nested spinner
            const descriptionOutput = document.getElementById('descriptionOutput');
            const descriptionText = document.getElementById('descriptionText');
            const copyDescriptionButton = document.getElementById('copyDescriptionButton');
            const audioPlayerContainer = document.getElementById('audioPlayerContainer'); // Not used in this version but kept for reference
            const audioPlayer = document.getElementById('audioPlayer'); // Not used in this version but kept for reference
            const errorMessage = document.getElementById('errorMessage');

            const openAskQuestionModalButton = document.getElementById('openAskQuestionModalButton');
            const askQuestionModal = document.getElementById('askQuestionModal');
            const closeAskQuestionModalButton = document.getElementById('closeAskQuestionModalButton');
            const questionInput = document.getElementById('questionInput');
            const answerQuestionButton = document.getElementById('answerQuestionButton');
            const answerQuestionButtonText = answerQuestionButton ? answerQuestionButton.querySelector('#answerQuestionButtonText') : null; // Get nested span
            const answerQuestionSpinner = answerQuestionButton ? answerQuestionButton.querySelector('.loading-spinner') : null; // Get nested spinner
            const questionOutput = document.getElementById('questionOutput');
            const answerText = document.getElementById('answerText');
            const copyAnswerButton = document.getElementById('copyAnswerButton');
            const questionErrorMessage = document.getElementById('questionErrorMessage');

            const analyzeEmotionButton = document.getElementById('analyzeEmotionButton');
            const emotionalOutput = document.getElementById('emotionalOutput');
            const emotionalText = document.getElementById('emotionalText');
            const copyEmotionalButton = document.getElementById('copyEmotionalButton');

            const getArtworkInfoButton = document.getElementById('getArtworkInfoButton');
            const artworkInfoOutput = document.getElementById('artworkInfoOutput');
            const artworkInfoText = document.getElementById('artworkInfoText');
            const copyArtworkInfoButton = document.getElementById('copyArtworkInfoButton');

            const showSignLanguageButton = document.getElementById('showSignLanguageButton');
            const signLanguageVideoContainer = document.getElementById('signLanguageVideoContainer');

            const descriptionLevelSelect = document.getElementById('descriptionLevel');
            const welcomeMessageDiv = document.getElementById('welcomeMessage');

            // QR Scanner elements
            const openQrScannerButton = document.getElementById('openQrScannerButton'); // This is the button within the modal content
            const qrScannerModal = document.getElementById('qrScannerModal');
            const closeQrScannerModalButton = document.getElementById('closeQrScannerModalButton');
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const qrStatus = document.getElementById('qrStatus');
            const qrErrorMessage = document.getElementById('qrErrorMessage');
            let videoStream = null;
            let animationFrameId = null;

            // Dummy artwork database (replace with Firestore in a real app)
            const artworkDatabase = {
                "qr-artwork-123": {
                    imageUrl: "https://placehold.co/400x300/A020F0/FFFFFF?text=Soyut+Sanat",
                    description: "Bu soyut eser, mor ve turuncu tonlarÄ±nda canlÄ± fÄ±rÃ§a darbeleriyle dolu, enerjik ve gizemli bir atmosfer sunuyor. FÄ±rÃ§a darbeleri, izleyiciyi derin dÃ¼ÅŸÃ¼ncelere sevk eden karmaÅŸÄ±k bir doku oluÅŸturuyor. Eser, soyut dÄ±ÅŸavurumculuÄŸun gÃ¼cÃ¼nÃ¼ yansÄ±tÄ±yor.",
                    emotionalAnalysis: "Bu eser, gÃ¼Ã§lÃ¼ ve Ã§arpÄ±cÄ± renklerin kullanÄ±mÄ±yla bir coÅŸku ve merak duygusu uyandÄ±rÄ±yor. Morun gizemi ve turuncunun enerjisi, izleyicide hem huzur hem de heyecan karÄ±ÅŸÄ±mÄ± bir his bÄ±rakÄ±yor.",
                    artworkInfo: "Eser AdÄ±: 'Mor ve Turuncu RÃ¼yalar'. SanatÃ§Ä±: Bilinmiyor. DÃ¶nem: Ã‡aÄŸdaÅŸ Sanat. Bu eser, sanatÃ§Ä±nÄ±n iÃ§ dÃ¼nyasÄ±ndaki zÄ±tlÄ±klarÄ± ve uyumu keÅŸfetme Ã§abasÄ±nÄ± temsil ediyor."
                },
                "qr-artwork-456": {
                    imageUrl: "https://placehold.co/400x300/008080/FFFFFF?text=Manzara",
                    description: "Bu manzara resmi, sakin bir gÃ¶l kenarÄ±nda, yeÅŸilin farklÄ± tonlarÄ±nda aÄŸaÃ§larla Ã§evrili huzurlu bir sahneyi betimliyor. GÃ¶kyÃ¼zÃ¼ aÃ§Ä±k ve berrak, suyun yÃ¼zeyi hafif dalgalanmalarla parlÄ±yor. Uzakta gÃ¶rÃ¼nen daÄŸlar, derinlik ve dinginlik katÄ±yor.",
                    emotionalAnalysis: "Bu eser, doÄŸanÄ±n dinginliÄŸini ve huzurunu yansÄ±tÄ±yor. YeÅŸil ve mavinin sakinleÅŸtirici tonlarÄ±, izleyicide rahatlama ve dinginlik hissi uyandÄ±rÄ±yor. Eser, kaÃ§Ä±ÅŸ ve huzur arayÄ±ÅŸÄ±nÄ± temsil ediyor.",
                    artworkInfo: "Eser AdÄ±: 'Sakin GÃ¶l'. SanatÃ§Ä±: AyÅŸe YÄ±lmaz. DÃ¶nem: Romantizm akÄ±mÄ±ndan etkilenmiÅŸ, 19. yÃ¼zyÄ±l sonlarÄ±. SanatÃ§Ä±, doÄŸanÄ±n insan Ã¼zerindeki iyileÅŸtirici gÃ¼cÃ¼nÃ¼ vurgulamayÄ± amaÃ§lamÄ±ÅŸtÄ±r."
                }
            };


            let base64ImageData = null;
            let mimeType = null;
            let isListening = false;
            let recognition;
            let lastSpokenText = "";

            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'tr-TR';
                    window.speechSynthesis.speak(utterance);
                    lastSpokenText = text;
                } else {
                    console.warn('TarayÄ±cÄ±nÄ±z metin okuma Ã¶zelliÄŸini desteklemiyor.');
                }
            };

            const resetUI = () => {
                if (fileNameSpan) fileNameSpan.textContent = 'GÃ¶rsel SeÃ§in veya SÃ¼rÃ¼kleyin';
                if (imagePreviewContainer) imagePreviewContainer.classList.add('hidden');
                if (imagePreview) imagePreview.src = '#';
                base64ImageData = null;
                mimeType = null;
                if (describeImageButton) describeImageButton.disabled = true;
                if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;
                if (descriptionOutput) descriptionOutput.classList.add('hidden');
                if (emotionalOutput) emotionalOutput.classList.add('hidden');
                if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                if (errorMessage) errorMessage.classList.add('hidden');
                if (questionOutput) questionOutput.classList.add('hidden');
                if (questionInput) questionInput.value = '';
                if (askQuestionModal) askQuestionModal.style.display = 'none';
                lastSpokenText = "";
                speak('Uygulama temizlendi. Yeni bir gÃ¶rsel yÃ¼kleyebilirsiniz.');
            };

            // Welcome message on load - now also hides itself after speaking
            window.addEventListener('DOMContentLoaded', () => {
                const welcomeText = "HoÅŸ geldiniz! Bu uygulama gÃ¶rselleri sesli betimler ve sorularÄ±nÄ±zÄ± yanÄ±tlar. Sergi gezintinizi kolaylaÅŸtÄ±rmak iÃ§in QR kod tarayÄ±cÄ± ve diÄŸer eriÅŸilebilirlik Ã¶zelliklerini kullanabilirsiniz. Sesli asistanÄ± baÅŸlatmak iÃ§in aÅŸaÄŸÄ±daki butona tÄ±klayabilirsiniz.";
                if (welcomeMessageDiv) {
                    welcomeMessageDiv.classList.remove('hidden');
                    speak(welcomeText);

                    setTimeout(() => {
                        if (welcomeMessageDiv) welcomeMessageDiv.classList.add('hidden');
                    }, 10000);
                }
            });


            if (imageUpload) {
                imageUpload.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        if (fileNameSpan) fileNameSpan.textContent = file.name;
                        mimeType = file.type;
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            if (imagePreview) imagePreview.src = e.target.result;
                            if (imagePreviewContainer) imagePreviewContainer.classList.remove('hidden');
                            base64ImageData = e.target.result.split(',')[1];
                            // Enable buttons related to image processing
                            if (describeImageButton) describeImageButton.disabled = false;
                            if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                            if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                            if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                            speak('GÃ¶rsel yÃ¼klendi. ArtÄ±k betimleyebilir, soru sorabilir, duygu analizi yapabilir veya sanatÃ§Ä± bilgisi alabilirsiniz.');
                        };
                        reader.readAsDataURL(file);
                    } else {
                        resetUI();
                        speak('GÃ¶rsel yÃ¼kleme iptal edildi veya dosya seÃ§ilmedi.');
                    }
                });
            }

            const fileInputLabel = document.querySelector('.file-input-label');
            if (fileInputLabel) {
                fileInputLabel.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInputLabel.classList.add('border-red-500'); /* Changed */
                });
                fileInputLabel.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInputLabel.classList.remove('border-red-500'); /* Changed */
                });
                fileInputLabel.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fileInputLabel.classList.remove('border-red-500'); /* Changed */
                    const files = e.dataTransfer.files;
                    if (files.length > 0 && imageUpload) {
                        imageUpload.files = files;
                        imageUpload.dispatchEvent(new Event('change'));
                    }
                });
            }

            if (describeImageButton) {
                describeImageButton.addEventListener('click', async () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.');
                        return;
                    }

                    // Hide all output sections before new processing
                    if (descriptionOutput) descriptionOutput.classList.add('hidden');
                    if (emotionalOutput) emotionalOutput.classList.add('hidden');
                    if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                    if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                    if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                    if (errorMessage) errorMessage.classList.add('hidden');

                    // Disable all processing buttons during operation
                    if (describeImageButton) describeImageButton.disabled = true;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;
                    
                    if (buttonText) buttonText.textContent = 'Betimleniyor...';
                    if (loadingSpinner) loadingSpinner.classList.remove('hidden');
                    if (questionOutput) questionOutput.classList.add('hidden');
                    speak('GÃ¶rsel betimleniyor, lÃ¼tfen bekleyin.');

                    const descriptionLevel = descriptionLevelSelect ? descriptionLevelSelect.value : 'simple';
                    let prompt = "";

                    if (descriptionLevel === 'simple') {
                        prompt = "Bu gÃ¶rselde ne gÃ¶rÃ¼yorsun? Bir sergideki sanat eseri gibi, ana Ã¶ÄŸeleri, genel atmosferi ve renklerin yarattÄ±ÄŸÄ± hissi vurgulayarak kÄ±sa ve Ã¶z bir ÅŸekilde betimle. GÃ¶rme engelli bir bireye sergide rehberlik ediyormuÅŸ gibi anlat. Renkleri doÄŸrudan isimleriyle belirtmek yerine, tonlarÄ±nÄ± ve yarattÄ±klarÄ± etkiyi Ã¶n plana Ã§Ä±kar (Ã¶rneÄŸin 'canlÄ± ve sÄ±cak tonlar', 'derin ve melankolik maviler' gibi). YaklaÅŸÄ±k 1 dakikalÄ±k bir anlatÄ±m olacak ÅŸekilde optimize et.";
                    } else { // complex
                        prompt = "Bu gÃ¶rselde ne gÃ¶rÃ¼yorsun? Bir sanat eseri gibi Ã§ok detaylÄ±, sanatsal ve duygusal bir dille betimle. GÃ¶rme engelli bir bireye sergide rehberlik ediyormuÅŸ gibi anlat. Kompozisyonu, Ä±ÅŸÄ±k kullanÄ±mÄ±nÄ±, dokularÄ±, figÃ¼rlerin veya nesnelerin detaylarÄ±nÄ± ve renklerin yarattÄ±ÄŸÄ± derinliÄŸi ve hissi vurgula. Renkleri doÄŸrudan isimleriyle belirtmek yerine, tonlarÄ±nÄ±, sÄ±caklÄ±klarÄ±nÄ±, soÄŸukluklarÄ±nÄ± ve yarattÄ±klarÄ± etkiyi Ã¶n plana Ã§Ä±kararak betimle. YaklaÅŸÄ±k 2 dakikalÄ±k bir anlatÄ±m olacak ÅŸekilde optimize et.";
                    }


                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; // API Key added here
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const description = result.candidates[0].content.parts[0].text;
                            if (descriptionText) descriptionText.textContent = description;
                            if (descriptionOutput) descriptionOutput.classList.remove('hidden');
                            speak(description);

                        } else {
                            if (errorMessage) {
                                errorMessage.textContent = 'GÃ¶rsel betimlemesi oluÅŸturulamadÄ±. LÃ¼tfen tekrar deneyin.';
                                errorMessage.classList.remove('hidden');
                            }
                            speak('GÃ¶rsel betimlemesi oluÅŸturulamadÄ±. LÃ¼tfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('GÃ¶rsel betimleme hatasÄ±:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        // Re-enable all processing buttons
                        if (describeImageButton) describeImageButton.disabled = false;
                        if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                        if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                        if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                        if (buttonText) buttonText.textContent = 'GÃ¶rseli Betimle';
                        if (loadingSpinner) loadingSpinner.classList.add('hidden');
                    }
                });
            }

            if (copyDescriptionButton) {
                copyDescriptionButton.addEventListener('click', () => {
                    if (descriptionText) {
                        const textToCopy = descriptionText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('Betimleme panoya kopyalandÄ±.');
                            } catch (err) {
                                console.error('Panoya kopyalama baÅŸarÄ±sÄ±z:', err);
                                speak('Betimleme panoya kopyalanamadÄ±.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            if (analyzeEmotionButton) {
                analyzeEmotionButton.addEventListener('click', async () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.');
                        return;
                    }

                    // Hide all output sections before new processing
                    if (descriptionOutput) descriptionOutput.classList.add('hidden');
                    if (emotionalOutput) emotionalOutput.classList.add('hidden');
                    if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                    if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                    if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                    if (errorMessage) errorMessage.classList.add('hidden');

                    // Disable all processing buttons during operation
                    if (describeImageButton) describeImageButton.disabled = true;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;

                    const analyzeEmotionButtonSpan = analyzeEmotionButton.querySelector('span');
                    const analyzeEmotionButtonSpinner = analyzeEmotionButton.querySelector('.loading-spinner');

                    if (analyzeEmotionButtonSpan) analyzeEmotionButtonSpan.textContent = 'Analiz Ediliyor...';
                    if (analyzeEmotionButtonSpinner) analyzeEmotionButtonSpinner.classList.remove('hidden');
                    speak('Duygu analizi yapÄ±lÄ±yor, lÃ¼tfen bekleyin.');

                    const prompt = "Bu gÃ¶rselde hangi duygusal tonu veya ruh halini gÃ¶rÃ¼yorsun? Bir sanat eseri olarak bu gÃ¶rselin izleyicide uyandÄ±rabileceÄŸi ana duygularÄ± ve bu duygularÄ± destekleyen gÃ¶rsel Ã¶ÄŸeleri (kompozisyon, Ä±ÅŸÄ±k, figÃ¼r ifadeleri vb.) sanatsal bir dille betimle. Renkleri doÄŸrudan isimleriyle belirtmek yerine, tonlarÄ±nÄ± ve yarattÄ±klarÄ± etkiyi Ã¶n plana Ã§Ä±kar. Sadece duygusal betimlemeyi ver, baÅŸka aÃ§Ä±klama yapma.";

                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; // API Key added here
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const emotionalDescription = result.candidates[0].content.parts[0].text;
                            if (emotionalText) emotionalText.textContent = emotionalDescription;
                            if (emotionalOutput) emotionalOutput.classList.remove('hidden');
                            speak(emotionalDescription);

                            // Update modal content if it's open
                            const modalEmotionOutput = document.getElementById('modalEmotionOutput');
                            const modalEmotionText = document.getElementById('modalEmotionText');
                            if (modalEmotionOutput && modalEmotionText) {
                                modalEmotionText.textContent = emotionalDescription;
                                modalEmotionOutput.classList.remove('hidden');
                            }

                        } else {
                            if (errorMessage) {
                                errorMessage.textContent = 'Duygu analizi yapÄ±lamadÄ±. LÃ¼tfen tekrar deneyin.';
                                errorMessage.classList.remove('hidden');
                            }
                            speak('Duygu analizi yapÄ±lamadÄ±. LÃ¼tfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('Duygu analizi hatasÄ±:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        // Re-enable all processing buttons
                        if (describeImageButton) describeImageButton.disabled = false;
                        if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                        if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                        if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                        if (analyzeEmotionButtonSpan) analyzeEmotionButtonSpan.textContent = 'Duygu Analizi';
                        if (analyzeEmotionButtonSpinner) analyzeEmotionButtonSpinner.classList.add('hidden');
                    }
                });
            }

            if (copyEmotionalButton) {
                copyEmotionalButton.addEventListener('click', () => {
                    if (emotionalText) {
                        const textToCopy = emotionalText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('Duygu analizi panoya kopyalandÄ±.');
                            } catch (err) {
                                console.error('Panoya kopyalama baÅŸarÄ±sÄ±z:', err);
                                speak('Duygu analizi panoya kopyalanamadÄ±.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            if (getArtworkInfoButton) {
                getArtworkInfoButton.addEventListener('click', async () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.');
                        return;
                    }

                    // Hide all output sections before new processing
                    if (descriptionOutput) descriptionOutput.classList.add('hidden');
                    if (emotionalOutput) emotionalOutput.classList.add('hidden');
                    if (artworkInfoOutput) artworkInfoOutput.classList.add('hidden');
                    if (signLanguageVideoContainer) signLanguageVideoContainer.classList.add('hidden');
                    if (audioPlayerContainer) audioPlayerContainer.classList.add('hidden');
                    if (errorMessage) errorMessage.classList.add('hidden');

                    // Disable all processing buttons during operation
                    if (describeImageButton) describeImageButton.disabled = true;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = true;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = true;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = true;

                    const getArtworkInfoButtonSpan = getArtworkInfoButton.querySelector('span');
                    const getArtworkInfoButtonSpinner = getArtworkInfoButton.querySelector('.loading-spinner');

                    if (getArtworkInfoButtonSpan) getArtworkInfoButtonSpan.textContent = 'Bilgi AlÄ±nÄ±yor...';
                    if (getArtworkInfoButtonSpinner) getArtworkInfoButtonSpinner.classList.remove('hidden');
                    speak('SanatÃ§Ä± ve eser bilgisi alÄ±nÄ±yor, lÃ¼tfen bekleyin.');

                    const prompt = "Bu gÃ¶rseldeki sanat eseri hakkÄ±nda bilgi verebilir misin? SanatÃ§Ä±sÄ± kim, eserin adÄ± ne, hangi dÃ¶nemde veya akÄ±mda yapÄ±lmÄ±ÅŸ, kÄ±sa bir tarihsel veya sanatsal baÄŸlamÄ±nÄ± aÃ§Ä±kla. GÃ¶rme engelli bir bireye sergide rehberlik ediyormuÅŸ gibi anlat. Sadece eserin ve sanatÃ§Ä±nÄ±n bilgisini ver, baÅŸka aÃ§Ä±klama yapma.";

                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; // API Key added here
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const artworkInfo = result.candidates[0].content.parts[0].text;
                            if (artworkInfoText) artworkInfoText.textContent = artworkInfo;
                            if (artworkInfoOutput) artworkInfoOutput.classList.remove('hidden');
                            speak(artworkInfo);

                        } else {
                            if (errorMessage) {
                                errorMessage.textContent = 'SanatÃ§Ä± ve eser bilgisi alÄ±namadÄ±. LÃ¼tfen tekrar deneyin.';
                                errorMessage.classList.remove('hidden');
                            }
                            speak('SanatÃ§Ä± ve eser bilgisi alÄ±namadÄ±. LÃ¼tfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('SanatÃ§Ä± ve eser bilgisi hatasÄ±:', error);
                        if (errorMessage) {
                            errorMessage.textContent = 'Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        // Re-enable all processing buttons
                        if (describeImageButton) describeImageButton.disabled = false;
                        if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                        if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                        if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                        if (getArtworkInfoButtonSpan) getArtworkInfoButtonSpan.textContent = 'SanatÃ§Ä± ve Eser Bilgisi';
                        if (getArtworkInfoButtonSpinner) getArtworkInfoButtonSpinner.classList.add('hidden');
                    }
                });
            }

            if (copyArtworkInfoButton) {
                copyArtworkInfoButton.addEventListener('click', () => {
                    if (artworkInfoText) {
                        const textToCopy = artworkInfoText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('SanatÃ§Ä± ve eser bilgisi panoya kopyalandÄ±.');
                            } catch (err) {
                                console.error('Panoya kopyalama baÅŸarÄ±sÄ±z:', err);
                                speak('SanatÃ§Ä± ve eser bilgisi panoya kopyalanamadÄ±.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            // Show Sign Language Placeholder
            if (showSignLanguageButton) {
                showSignLanguageButton.addEventListener('click', () => {
                    if (signLanguageVideoContainer) {
                        if (signLanguageVideoContainer.classList.contains('hidden')) {
                            signLanguageVideoContainer.classList.remove('hidden');
                            speak('TÃ¼rkÃ§e Ä°ÅŸaret Dili betimlemesi gÃ¶steriliyor. Bu alanda ilgili gÃ¶rselin iÅŸaret dili videosu yer alacaktÄ±r.');
                        } else {
                            signLanguageVideoContainer.classList.add('hidden');
                            speak('TÃ¼rkÃ§e Ä°ÅŸaret Dili betimlemesi gizlendi.');
                        }
                    }
                });
            }


            if (openAskQuestionModalButton) {
                openAskQuestionModalButton.addEventListener('click', () => {
                    if (!base64ImageData) {
                        if (errorMessage) {
                            errorMessage.textContent = 'LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.');
                        return;
                    }
                    if (questionInput) questionInput.value = '';
                    if (questionOutput) questionOutput.classList.add('hidden');
                    if (questionErrorMessage) questionErrorMessage.classList.add('hidden');
                    if (answerQuestionButton) answerQuestionButton.disabled = false;
                    if (answerQuestionButtonText) answerQuestionButtonText.textContent = 'Cevapla';
                    if (answerQuestionSpinner) answerQuestionSpinner.classList.add('hidden');
                    if (askQuestionModal) askQuestionModal.style.display = 'flex';
                    speak('GÃ¶rsel hakkÄ±nda sorunuzu sorabilirsiniz.');
                });
            }

            if (closeAskQuestionModalButton) {
                closeAskQuestionModalButton.addEventListener('click', () => {
                    if (askQuestionModal) askQuestionModal.style.display = 'none';
                    speak('Soru sorma ekranÄ± kapatÄ±ldÄ±.');
                });
            }

            window.addEventListener('click', (event) => {
                if (event.target == askQuestionModal && askQuestionModal) {
                    askQuestionModal.style.display = 'none';
                    speak('Soru sorma ekranÄ± kapatÄ±ldÄ±.');
                }
            });

            if (answerQuestionButton) {
                answerQuestionButton.addEventListener('click', async () => {
                    const userQuestion = questionInput ? questionInput.value.trim() : '';
                    if (!userQuestion) {
                        if (questionErrorMessage) {
                            questionErrorMessage.textContent = 'LÃ¼tfen bir soru girin.';
                            questionErrorMessage.classList.remove('hidden');
                        }
                        speak('LÃ¼tfen bir soru girin.');
                        return;
                    }

                    if (answerQuestionButton) answerQuestionButton.disabled = true;
                    if (answerQuestionButtonText) answerQuestionButtonText.textContent = 'CevaplanÄ±yor...';
                    if (answerQuestionSpinner) answerQuestionSpinner.classList.remove('hidden');
                    if (questionOutput) questionOutput.classList.add('hidden');
                    if (questionErrorMessage) questionErrorMessage.classList.add('hidden');
                    speak('Sorunuz cevaplanÄ±yor, lÃ¼tfen bekleyin.');

                    const prompt = `Bu gÃ¶rselde ne gÃ¶rÃ¼yorsun? Bir sergideki sanat eseri baÄŸlamÄ±nda, sorulan soruya gÃ¶re gÃ¶rseli analiz et ve detaylÄ± bir cevap ver. KullanÄ±cÄ±nÄ±n sorusu bir nesneye veya alana odaklanÄ±yorsa, o nesneyi/alanÄ± Ã¶zellikle detaylandÄ±r. Renkleri doÄŸrudan isimleriyle belirtmek yerine, tonlarÄ±nÄ± ve yarattÄ±klarÄ± etkiyi Ã¶n plana Ã§Ä±kar. Soru: "${userQuestion}"`;

                    try {
                        const payload = {
                            contents: [
                                {
                                    role: "user",
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64ImageData
                                            }
                                        }
                                    ]
                                }
                            ],
                        };

                        const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; // API Key added here
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const answer = result.candidates[0].content.parts[0].text;
                            if (answerText) answerText.textContent = answer;
                            if (questionOutput) questionOutput.classList.remove('hidden');
                            speak(answer);

                        } else {
                            if (questionErrorMessage) {
                                questionErrorMessage.textContent = 'Sorunuza cevap oluÅŸturulamadÄ±. LÃ¼tfen tekrar deneyin.';
                                questionErrorMessage.classList.remove('hidden');
                            }
                            speak('Sorunuza cevap oluÅŸturulamadÄ±. LÃ¼tfen tekrar deneyin.');
                        }
                    } catch (error) {
                        console.error('Soru cevaplama hatasÄ±:', error);
                        if (questionErrorMessage) {
                            questionErrorMessage.textContent = 'Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.';
                            errorMessage.classList.remove('hidden');
                        }
                        speak('Bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.');
                    } finally {
                        if (answerQuestionButton) answerQuestionButton.disabled = false;
                        if (answerQuestionButtonText) answerQuestionButtonText.textContent = 'Cevapla';
                        if (answerQuestionSpinner) answerQuestionSpinner.classList.add('hidden');
                    }
                });
            }

            if (copyAnswerButton) {
                copyAnswerButton.addEventListener('click', () => {
                    if (answerText) {
                        const textToCopy = answerText.textContent;
                        if (textToCopy) {
                            const textarea = document.createElement('textarea');
                            textarea.value = textToCopy;
                            document.body.appendChild(textarea);
                            textarea.select();
                            try {
                                document.execCommand('copy');
                                speak('Cevap panoya kopyalandÄ±.');
                            } catch (err) {
                                console.error('Panoya kopyalama baÅŸarÄ±sÄ±z:', err);
                                speak('Cevap panoya kopyalanamadÄ±.');
                            }
                            document.body.removeChild(textarea);
                        }
                    }
                });
            }

            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'tr-TR';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = () => {
                    isListening = true;
                    // Show listening animation
                    if (listeningAnimation) listeningAnimation.classList.remove('hidden');
                    if (startVoiceButton) {
                        startVoiceButton.textContent = 'Dinleniyor...';
                        startVoiceButton.disabled = true;
                    }
                    speak('Sesli asistan dinlemeye baÅŸladÄ±.');
                };

                recognition.onend = () => {
                    isListening = false;
                    // Hide listening animation
                    if (listeningAnimation) listeningAnimation.classList.add('hidden');
                    if (startVoiceButton) {
                        startVoiceButton.textContent = 'KonuÅŸmaya BaÅŸla';
                        startVoiceButton.disabled = false;
                    }
                    console.log('Voice assistant stopped listening.');
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    speak(`Ses tanÄ±ma hatasÄ±: ${event.error}. LÃ¼tfen tekrar deneyin.`);
                    isListening = false;
                    if (listeningAnimation) listeningAnimation.classList.add('hidden');
                    if (startVoiceButton) {
                        startVoiceButton.textContent = 'KonuÅŸmaya BaÅŸla';
                        startVoiceButton.disabled = false;
                    }
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    console.log('TanÄ±nan komut:', transcript);
                    sendMessage(transcript); // Send recognized speech as user message
                };

                // The floating voice assistant button now directly controls recognition
                if (voiceAssistantButton) {
                    voiceAssistantButton.addEventListener('click', () => {
                        if (isListening) {
                            recognition.stop();
                        } else {
                            recognition.start();
                        }
                    });
                }

            } else {
                if (voiceAssistantButton) {
                    voiceAssistantButton.style.display = 'none'; // Hide if not supported
                }
                console.warn('Web Speech API (SpeechRecognition) tarayÄ±cÄ±nÄ±zda desteklenmiyor.');
            }

            const processVoiceCommand = (command) => {
                if (askQuestionModal && askQuestionModal.style.display === 'flex') {
                    if (questionInput) questionInput.value = command;
                    if (answerQuestionButton) answerQuestionButton.click();
                    return;
                }

                if (command.includes('gÃ¶rsel yÃ¼kle') || command.includes('resim yÃ¼kle')) {
                    if (imageUpload) imageUpload.click();
                    speak('GÃ¶rsel yÃ¼klemek iÃ§in dosya seÃ§ici aÃ§Ä±ldÄ±.');
                } else if (command.includes('gÃ¶rseli betimle') || command.includes('betimle')) {
                    if (describeImageButton) describeImageButton.click();
                } else if (command.includes('soru sor') || command.includes('gÃ¶rsel hakkÄ±nda soru sor')) {
                    if (openAskQuestionModalButton) openAskQuestionModalButton.click();
                } else if (command.includes('duygu analizi yap') || command.includes('duygularÄ± analiz et')) {
                    // Simulate clicking the emotion analysis feature card
                    const emotionAnalysisCard = document.querySelector('[data-feature="emotion-analysis"]');
                    if (emotionAnalysisCard) emotionAnalysisCard.click();
                    // Then trigger the actual analysis if an image is loaded
                    if (base64ImageData && analyzeEmotionButton) {
                        analyzeEmotionButton.click();
                    } else {
                        speak('LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin veya QR kodu tarayÄ±n.');
                    }
                } else if (command.includes('sanatÃ§Ä± bilgisi ver') || command.includes('eser hakkÄ±nda bilgi ver')) {
                    // Simulate clicking the artwork info feature card
                    const artworkInfoCard = document.querySelector('[data-feature="artwork-info"]');
                    if (artworkInfoCard) artworkInfoCard.click();
                    // Then trigger the actual info retrieval if an image is loaded
                    if (base64ImageData && getArtworkInfoButton) {
                        getArtworkInfoButton.click();
                    } else {
                        speak('LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin veya QR kodu tarayÄ±n.');
                    }
                } else if (command.includes('iÅŸaret dilini gÃ¶ster') || command.includes('iÅŸaret dilini aÃ§')) {
                    if (showSignLanguageButton) showSignLanguageButton.click();
                } else if (command.includes('qr kodu tara') || command.includes('kare kodu oku')) {
                    const qrScannerCard = document.querySelector('[data-feature="qr-scanner"]');
                    if(qrScannerCard) qrScannerCard.click();
                }
                else if (command.includes('temizle') || command.includes('uygulamayÄ± temizle')) {
                    resetUI();
                } else if (command.includes('tekrar et') || command.includes('sonuncuyu tekrar et')) {
                    if (lastSpokenText) {
                        speak(lastSpokenText);
                    } else {
                        speak('Tekrar edilecek bir ÅŸey yok.');
                    }
                } else if (command.includes('basit betimle') || command.includes('kÄ±sa betimle')) {
                    if (descriptionLevelSelect) descriptionLevelSelect.value = 'simple';
                    speak('Betimleme seviyesi basite ayarlandÄ±.');
                    if (describeImageButton) describeImageButton.click();
                } else if (command.includes('kapsamlÄ± betimle') || command.includes('detaylÄ± betimle')) {
                    if (descriptionLevelSelect) descriptionLevelSelect.value = 'complex';
                    speak('Betimleme seviyesi kapsamlÄ±ya ayarlandÄ±.');
                    if (describeImageButton) describeImageButton.click();
                }
                // Voice commands for existing accessibility features
                else if (command.includes('yazÄ± boyutunu bÃ¼yÃ¼t')) {
                    if (increaseTextButton) increaseTextButton.click();
                    speak('YazÄ± boyutu bÃ¼yÃ¼tÃ¼ldÃ¼.');
                } else if (command.includes('yazÄ± boyutunu kÃ¼Ã§Ã¼lt')) {
                    if (decreaseTextButton) decreaseTextButton.click();
                    speak('YazÄ± boyutu kÃ¼Ã§Ã¼ltÃ¼ldÃ¼.');
                } else if (command.includes('yazÄ± boyutunu sÄ±fÄ±rla')) {
                    if (resetTextButton) resetTextButton.click();
                    speak('YazÄ± boyutu sÄ±fÄ±rlandÄ±.');
                } else if (command.includes('yÃ¼ksek kontrast modunu aÃ§') || command.includes('yÃ¼ksek kontrast')) {
                    if (toggleContrastButton) toggleContrastButton.click();
                    speak('YÃ¼ksek kontrast modu deÄŸiÅŸtirildi.');
                } else if (command.includes('ekran okuyucu modunu aÃ§') || command.includes('ekran okuyucu')) {
                    if (toggleScreenReaderButton) toggleScreenReaderButton.click();
                    speak('Ekran okuyucu modu deÄŸiÅŸtirildi.');
                } else if (command.includes('sesli rehberi aÃ§')) {
                    const audioGuideCard = document.querySelector('[data-feature="audio-guide"]');
                    if (audioGuideCard) audioGuideCard.click();
                    speak('Sesli rehber aÃ§Ä±ldÄ±.');
                } else if (command.includes('eriÅŸilebilir haritayÄ± aÃ§')) {
                    const accessibleMapCard = document.querySelector('[data-feature="accessible-map"]');
                    if (accessibleMapCard) accessibleMapCard.click();
                    speak('EriÅŸilebilir harita aÃ§Ä±ldÄ±.');
                } else if (command.includes('eser bilgilerini aÃ§')) {
                    const artworkInfoCard = document.querySelector('[data-feature="artwork-info"]');
                    if (artworkInfoCard) artworkInfoCard.click();
                    speak('Eser bilgileri aÃ§Ä±ldÄ±.');
                } else if (command.includes('yardÄ±m ve desteÄŸi aÃ§')) {
                    const helpSupportCard = document.querySelector('[data-feature="help-support"]');
                    if (helpSupportCard) helpSupportCard.click();
                    speak('YardÄ±m ve destek ekranÄ± aÃ§Ä±ldÄ±.');
                }
                else {
                    // Fallback to LLM for general questions
                    respondToMessage(command); // This will call the LLM
                }
            };

            // --- QR Scanner Logic ---
            let stream; // To hold the camera stream

            // This openQrScannerButton is the one inside the modal content, not the feature card
            const startModalQrScannerButton = document.getElementById('startModalQrScannerButton');
            if (startModalQrScannerButton) {
                startModalQrScannerButton.addEventListener('click', () => {
                    if (qrScannerModal) qrScannerModal.style.display = 'flex';
                    if (qrStatus) qrStatus.textContent = 'Kamera baÅŸlatÄ±lÄ±yor...';
                    if (qrErrorMessage) qrErrorMessage.classList.add('hidden');
                    speak('QR kod tarayÄ±cÄ± aÃ§Ä±ldÄ±. LÃ¼tfen kameranÄ±zÄ± QR koduna doÄŸru tutun.');

                    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }) // Prefer rear camera
                        .then((s) => {
                            stream = s;
                            if (video) {
                                video.srcObject = stream;
                                video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
                                video.play();
                            }
                            requestAnimationFrame(tick);
                            if (qrStatus) qrStatus.textContent = 'Kamera aktif.';
                        })
                        .catch((err) => {
                            console.error("Kamera eriÅŸim hatasÄ±:", err);
                            if (qrErrorMessage) {
                                qrErrorMessage.textContent = 'Kamera eriÅŸimi reddedildi veya kullanÄ±lamÄ±yor. LÃ¼tfen kamera iznini kontrol edin.';
                                qrErrorMessage.classList.remove('hidden');
                            }
                            if (qrStatus) qrStatus.textContent = 'Kamera hatasÄ±.';
                            speak('Kamera eriÅŸimi reddedildi veya kullanÄ±lamÄ±yor. LÃ¼tfen kamera iznini kontrol edin.');
                        });
                });
            }


            if (closeQrScannerModalButton) {
                closeQrScannerModalButton.addEventListener('click', () => {
                    if (qrScannerModal) qrScannerModal.style.display = 'none';
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop()); // Stop camera stream
                        stream = null;
                    }
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                    }
                    if (qrStatus) qrStatus.textContent = 'KapalÄ±';
                    speak('QR kod tarayÄ±cÄ± kapatÄ±ldÄ±.');
                });
            }

            function tick() {
                if (video && video.readyState === video.HAVE_ENOUGH_DATA && canvas) {
                    canvas.hidden = false;
                    let canvasElement = canvas;
                    let canvasContext = canvasElement.getContext("2d");

                    canvasElement.height = video.videoHeight;
                    canvasElement.width = video.videoWidth;
                    canvasContext.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                    let imageData = canvasContext.getImageData(0, 0, canvasElement.width, canvasElement.height);
                    let code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "dontInvert",
                    });

                    if (code) {
                        if (qrStatus) qrStatus.textContent = `QR Kodu AlgÄ±landÄ±: ${code.data}`;
                        speak(`QR Kodu algÄ±landÄ±: ${code.data}. Bilgiler yÃ¼kleniyor.`);
                        processQrCodeData(code.data);
                        if (closeQrScannerModalButton) closeQrScannerModalButton.click(); // Close scanner after successful scan
                        return; // Stop further scanning
                    } else {
                        if (qrStatus) qrStatus.textContent = 'QR kodu taranÄ±yor...';
                    }
                }
                animationFrameId = requestAnimationFrame(tick);
            }

            function processQrCodeData(qrData) {
                // This is where you'd typically fetch data from a backend (e.g., Firestore)
                // based on the qrData (which would be an artwork ID).
                // For this example, we use a dummy local database.

                const artwork = artworkDatabase[qrData];

                if (artwork) {
                    // Simulate loading the image (if you had the actual image URL)
                    if (imagePreview) imagePreview.src = artwork.imageUrl; // Use dummy image URL
                    if (imagePreviewContainer) imagePreviewContainer.classList.remove('hidden');
                    if (fileNameSpan) fileNameSpan.textContent = `QR Kodu ile YÃ¼klendi: ${qrData}`;
                    base64ImageData = null; // Clear base64 as we don't have it from QR scan directly
                    mimeType = 'image/jpeg'; // Assume a default mime type for dummy image

                    // Update main output sections
                    if (descriptionText) descriptionText.textContent = artwork.description;
                    if (descriptionOutput) descriptionOutput.classList.remove('hidden');
                    
                    if (emotionalText) emotionalText.textContent = artwork.emotionalAnalysis;
                    if (emotionalOutput) emotionalOutput.classList.remove('hidden');

                    if (artworkInfoText) artworkInfoText.textContent = artwork.artworkInfo;
                    if (artworkInfoOutput) artworkInfoOutput.classList.remove('hidden');

                    speak(artwork.description); // Speak the description first

                    // Enable all processing buttons as if an image was manually loaded
                    if (describeImageButton) describeImageButton.disabled = false;
                    if (openAskQuestionModalButton) openAskQuestionModalButton.disabled = false;
                    if (analyzeEmotionButton) analyzeEmotionButton.disabled = false;
                    if (getArtworkInfoButton) getArtworkInfoButton.disabled = false;
                    if (errorMessage) errorMessage.classList.add('hidden'); // Clear any previous errors
                    speak('Eser bilgileri yÃ¼klendi.');

                } else {
                    if (errorMessage) {
                        errorMessage.textContent = `Bu QR kodu iÃ§in eser bilgisi bulunamadÄ±: ${qrData}.`;
                        errorMessage.classList.remove('hidden');
                    }
                    speak(`Bu QR kodu iÃ§in eser bilgisi bulunamadÄ±: ${qrData}.`);
                    resetUI(); // Clear everything if artwork not found
                }
            }

            // Tab Switching Logic
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;

                    // Deactivate all buttons and hide all content
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Activate the clicked button and show its content
                    button.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        });
    </script>
</body>
</html>
